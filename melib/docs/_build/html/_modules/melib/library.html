
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>melib.library &#8212; melib June 2021 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for melib.library</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    **library.py**</span>

<span class="sd">    Routines to perform short mechanical engineering design tasks without explicit instantiation.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">cmath</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="c1"># import matplotlib.pyplot as plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1"># sys.path.insert(0, &quot;.&quot;)</span>
<span class="kn">from</span> <span class="nn">melib.xt</span> <span class="kn">import</span> <span class="n">mdxziplist</span><span class="p">,</span><span class="n">engfmt</span><span class="p">,</span><span class="n">openplot</span>
<span class="kn">from</span> <span class="nn">melib.excel</span> <span class="kn">import</span> <span class="n">Xcel</span>

<span class="n">PIE</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">XXXX</span> <span class="o">=</span> <span class="s2">&quot;Dummy&quot;</span>

<span class="k">def</span> <span class="nf">calcrecord</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">CALCRECORD</span>


<span class="k">def</span> <span class="nf">resetrecord</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="n">s</span>


<span class="c1">#</span>
<span class="c1">#TESTING = &#39;bmdiagram&#39;</span>
<span class="c1"># TESTING=&quot;bearingpick&quot;</span>
<span class="c1"># TESTING=&quot;isofits&quot;</span>
<span class="n">TESTING</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="n">SVAR</span> <span class="o">=</span> <span class="s2">&quot; _ssssss_ &quot;</span>
<span class="n">NVAR</span> <span class="o">=</span> <span class="s2">&quot; _nnnnnn_ &quot;</span>
<span class="c1"># the arguments should str, e.g. unitconvert(&quot;Calories_per_Cm2Min&quot;,&quot;W_per_M2&quot;)</span>


<div class="viewcode-block" id="unitconvert"><a class="viewcode-back" href="../../api.html#melib.library.unitconvert">[docs]</a><span class="k">def</span> <span class="nf">unitconvert</span><span class="p">(</span><span class="n">fromunit</span><span class="p">,</span> <span class="n">tounit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the coefficient to convert a number from one unit to another.  For example,</span>

<span class="sd">    &gt;&gt;&gt; y=x*unitconvert(&quot;Calories_per_Cm2Min&quot;,&quot;W_per_M2&quot;)</span>

<span class="sd">    will convert &#39;x&#39; in units of &#39;Cal/(cm2-min)&#39; to &#39;y&#39; in &#39;Watts/m2&#39;.</span>

<span class="sd">    The supported unit pairs are:</span>

<span class="sd">    * &quot;Calories_per_Cm2Min&quot; ---&gt; &quot;W_per_M2&quot;</span>

<span class="sd">    * &quot;Grams_per_Dm2Hr&quot;     ---&gt; &quot;Kg_per_M2H&quot;</span>

<span class="sd">    * &quot;Lbf_inch&quot;            ---&gt; &quot;N-m&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Irradiance from calories/(cm2-min)</span>
    <span class="n">Calories_per_Cm2Min</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;W_per_M2&#39;</span><span class="p">:</span> <span class="mi">697</span><span class="p">}</span>
    <span class="c1"># Transpiration rate from g/(dm2-h)</span>
    <span class="n">Grams_per_Dm2Hr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Kg_per_M2H&quot;</span><span class="p">:</span> <span class="mf">4e-05</span><span class="p">}</span>
    <span class="n">Lbf_inch</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;N-m&quot;</span><span class="p">:</span> <span class="mf">0.113</span><span class="p">}</span>  <span class="c1"># 1 lbf-in=1/2.204*9.81*0.0254 N-m</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">fromunit</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">tounit</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span></div>


<span class="k">def</span> <span class="nf">dictquery</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> data exist only for the following (&#39;+++&#39; means that a second argument needs to be provided, e.g. temperature):</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;dname&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">!=</span><span class="s2">&quot;dname&quot;</span><span class="p">:</span>
                <span class="n">zs</span><span class="o">=</span><span class="s2">&quot;* &quot;</span><span class="o">+</span><span class="n">s</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">zs</span><span class="o">+=</span><span class="s2">&quot; +&quot;</span>
                <span class="n">z</span> <span class="o">+=</span> <span class="n">zs</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


<div class="viewcode-block" id="thconductivity"><a class="viewcode-back" href="../../api.html#melib.library.thconductivity">[docs]</a><span class="k">def</span> <span class="nf">thconductivity</span><span class="p">(</span><span class="n">metal</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot; Returns the thermal conductivity[W/m-C] of the metal.  The second argument is the temperature[ :superscript:`o` C].</span>
<span class="sd">    Enter</span>

<span class="sd">    &gt;&gt;&gt; print(thconductivity(&quot;?&quot;))</span>

<span class="sd">    to see the supported metals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">thca</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;inconel 750&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">149</span><span class="p">,</span> <span class="mi">316</span><span class="p">,</span> <span class="mi">538</span><span class="p">,</span> <span class="mi">649</span><span class="p">,</span> <span class="mi">760</span><span class="p">,</span> <span class="mi">871</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">16.9</span><span class="p">,</span> <span class="mf">20.5</span><span class="p">,</span> <span class="mf">26.5</span><span class="p">,</span> <span class="mf">28.7</span><span class="p">,</span> <span class="mf">31.4</span><span class="p">,</span> <span class="mf">35.3</span><span class="p">])),</span>
            <span class="s2">&quot;ss304&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">16.2</span><span class="p">])),</span> <span class="s2">&quot;dname&quot;</span><span class="p">:</span> <span class="s2">&quot;Thermal Conductivity(W/m-C)&quot;</span><span class="p">}</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">dictquery</span><span class="p">(</span><span class="n">thca</span><span class="p">,</span> <span class="n">metal</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">metal</span> <span class="ow">in</span> <span class="n">thca</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">thc</span> <span class="o">=</span> <span class="n">thca</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">T</span><span class="o">==</span><span class="p">[]:</span> <span class="n">T</span><span class="o">=</span><span class="n">thc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">thc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">thc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">thc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Thermal Conductivity data for </span><span class="si">%s</span><span class="s2">.  Returns 0.&quot;</span> <span class="o">%</span> <span class="n">metal</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>


<div class="viewcode-block" id="density"><a class="viewcode-back" href="../../api.html#melib.library.density">[docs]</a><span class="k">def</span> <span class="nf">density</span><span class="p">(</span><span class="n">metal</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot; Returns the density[kg/m3] of the metal.  The optional second argument is the temperature[ :superscript:`o` C].</span>
<span class="sd">    Enter</span>

<span class="sd">    &gt;&gt;&gt; print(thconductivity(&quot;?&quot;))</span>

<span class="sd">    to see the supported metals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">density_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;inconel 750&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">8250</span><span class="p">])),</span> <span class="s2">&quot;ss304&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">8030</span><span class="p">])),</span>
                    <span class="s2">&quot;steel&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7850</span><span class="p">])),</span> <span class="s2">&quot;alum&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2700</span><span class="p">])),</span> <span class="s2">&quot;dname&quot;</span><span class="p">:</span> <span class="s2">&quot;Density[kg/m3]&quot;</span><span class="p">}</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">dictquery</span><span class="p">(</span><span class="n">density_data</span><span class="p">,</span> <span class="n">metal</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">density_data</span><span class="p">[</span><span class="n">metal</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">T</span><span class="o">==</span><span class="p">[]:</span> <span class="n">T</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<span class="c1">#</span>


<div class="viewcode-block" id="opendatafiles"><a class="viewcode-back" href="../../api.html#melib.library.opendatafiles">[docs]</a><span class="k">def</span> <span class="nf">opendatafiles</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bearing&quot;</span><span class="p">,</span> <span class="s2">&quot;mats&quot;</span><span class="p">,</span> <span class="s2">&quot;sgear&quot;</span><span class="p">,</span> <span class="s2">&quot;shaft&quot;</span><span class="p">,</span> <span class="s2">&quot;vbelt&quot;</span><span class="p">],</span> <span class="n">makezip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Action</span>
<span class="sd">        Opens the Excel files in the `data` folder and returns file pointers.</span>


<span class="sd">    Arguments</span>
<span class="sd">        `tags` : Array of strings.</span>
<span class="sd">        Excel file names.  All data files will be opened if tags is unspecified.</span>

<span class="sd">        `makezip` : Boolean.</span>
<span class="sd">        Whether to add the files to a zip package (used in notebooks).</span>

<span class="sd">    Returns</span>
<span class="sd">        Xcel pointers to the data files.  You may have to use these pointers when calling</span>
<span class="sd">        other `library` functions.</span>

<span class="sd">    Example</span>

<span class="sd">        &gt;&gt;&gt; [Xbear, Xmat, Xgear, Xshaft, Xbelt]=opendatafiles()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
        <span class="c1">#        datafilename=DATAFOLDER+&quot;\\&quot;+&quot;%s.xlsx&quot;%s</span>
        <span class="n">datafilename</span><span class="o">=</span><span class="n">pt</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">data</span><span class="se">\\</span><span class="si">%s</span><span class="s2">.xlsx&quot;</span><span class="o">%</span><span class="n">s</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Xcel</span><span class="p">(</span><span class="n">datafilename</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">makezip</span><span class="p">:</span>
            <span class="n">mdxziplist</span><span class="p">([</span><span class="n">datafilename</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="alloyprop"><a class="viewcode-back" href="../../api.html#melib.library.alloyprop">[docs]</a><span class="k">def</span> <span class="nf">alloyprop</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">alloyname</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Action</span>
<span class="sd">        Alloy material property look up. Uses the files in the `data` folder.</span>

<span class="sd">    Arguments</span>
<span class="sd">        `x` :  Xcel pointer to `mats.xlsx`.  See the file for supported metals.</span>

<span class="sd">        `base` : Sheet name in `matx.xlsx`, e.g. *steel*, *alum*, *titanium*, *nickel*</span>

<span class="sd">        `alloyname` : Alloy designation as they appear in column C of the Excel sheet, e.g. &quot;1350-H19&quot;</span>

<span class="sd">        `props` : Properties wanted as in the HEADINGS in the file, e.g. *[&#39;SUMPA&#39;, &#39;SYMPA&#39;]* to get Su and Sy</span>

<span class="sd">    Example</span>
<span class="sd">        &gt;&gt;&gt; xmat=opendatafiles(tags=[&quot;mats&quot;])[0]</span>
<span class="sd">        &gt;&gt;&gt; [su, sy, rho]=alloyprop(xmat, &quot;nickel&quot;, &quot;N06110&quot;, [&quot;SUMPA&quot;, &quot;SYMPA&quot;, &quot;RHO&quot;])</span>
<span class="sd">        &gt;&gt;&gt; print(su, sy, rho)</span>
<span class="sd">        &gt;&gt;&gt; 1205.0 1034.0 8330.0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">opendatafiles</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mats&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">noftables</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">vir</span><span class="p">(</span><span class="s2">&quot;NOFTABLES&quot;</span><span class="p">)</span>
    <span class="n">tablenum</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rnvit</span><span class="p">(</span><span class="n">tablenum</span><span class="p">,</span> <span class="n">alloyname</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">tablenum</span> <span class="o">&lt;</span> <span class="n">noftables</span><span class="p">:</span>
        <span class="n">tablenum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rnvit</span><span class="p">(</span><span class="n">tablenum</span><span class="p">,</span> <span class="n">alloyname</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span></div>

<div class="viewcode-block" id="alumprop"><a class="viewcode-back" href="../../api.html#melib.library.alumprop">[docs]</a><span class="k">def</span> <span class="nf">alumprop</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alloyname</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Short cut for `alloyprop(x, &quot;alum&quot;, alloyname, props)`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">alloyprop</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;alum&quot;</span><span class="p">,</span> <span class="n">alloyname</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span></div>


<div class="viewcode-block" id="titanprop"><a class="viewcode-back" href="../../api.html#melib.library.titanprop">[docs]</a><span class="k">def</span> <span class="nf">titanprop</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alloyname</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Short cut for `alloyprop(x, &quot;titanium&quot;, alloyname, props)`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">alloyprop</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;titanium&quot;</span><span class="p">,</span> <span class="n">alloyname</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span></div>


<div class="viewcode-block" id="steelprop"><a class="viewcode-back" href="../../api.html#melib.library.steelprop">[docs]</a><span class="k">def</span> <span class="nf">steelprop</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alloyname</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Short cut for `alloyprop(x, &quot;STEELS&quot;, alloyname, props)`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">alloyprop</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;steel&quot;</span><span class="p">,</span> <span class="n">alloyname</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span></div>

<span class="c1"># COLUMNS</span>


<div class="viewcode-block" id="fixity"><a class="viewcode-back" href="../../api.html#melib.library.fixity">[docs]</a><span class="k">def</span> <span class="nf">fixity</span><span class="p">(</span><span class="n">econ</span><span class="p">,</span> <span class="n">ideal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># e.g. econ=&quot;pinned-pinned&quot;</span>
    <span class="sd">&quot;&quot;&quot; Returns the value of the constant K in the Euler equation for</span>
<span class="sd">    buckling.  The arguments are</span>

<span class="sd">    econ : End conditions.  Could be:</span>
<span class="sd">              &quot;pinned-pinned&quot;</span>
<span class="sd">              &quot;fixed-fixed&quot;</span>
<span class="sd">              &quot;fixed-free&quot; (or &quot;free-fixed&quot;)</span>
<span class="sd">              &quot;fixed-pinned&quot; (or &quot;pinned-fixed&quot;)</span>
<span class="sd">    ideal : Returns theoretical values if this True.</span>
<span class="sd">            Otherwise, returns practical values</span>

<span class="sd">    Example</span>
<span class="sd">        &gt;&gt;&gt; Ka=fixity(&quot;pinned-fixed&quot;)  # Actual value For pinned-fixed ends</span>
<span class="sd">        &gt;&gt;&gt; Ki=fixity(&quot;pinned-fixed&quot;, ideal=True)  # Ideal value For pinned-fixed ends</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">did</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pinned-pinned&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;fixed-fixed&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
           <span class="s2">&quot;fixed-free&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;fixed-pinned&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>
    <span class="n">dpr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pinned-pinned&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;fixed-fixed&quot;</span><span class="p">:</span> <span class="mf">0.65</span><span class="p">,</span>
           <span class="s2">&quot;fixed-free&quot;</span><span class="p">:</span> <span class="mf">2.1</span><span class="p">,</span> <span class="s2">&quot;fixed-pinned&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">}</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">econ</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;free-fixed&quot;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;fixed-free&quot;</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;pinned-fixed&quot;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;fixed-pinned&quot;</span>
    <span class="k">if</span> <span class="n">ideal</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">did</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dpr</span><span class="p">[</span><span class="n">s</span><span class="p">]</span></div>
<span class="c1"># Welded joints</span>
<span class="c1"># t : Plate thickness</span>
<span class="c1"># Returns the minimum fillet weld sizes for this plate thickness</span>
<div class="viewcode-block" id="weldsize"><a class="viewcode-back" href="../../api.html#melib.library.weldsize">[docs]</a><span class="k">def</span> <span class="nf">weldsize</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the minimum weld size[mm] for plate thickness &#39;t&#39;[mm]</span>

<span class="sd">    Argument</span>
<span class="sd">        `t` : Plate thickness in mm</span>

<span class="sd">    Returns</span>
<span class="sd">        The minimum weld size[mm] recommended for this plate thickness</span>

<span class="sd">    Example:</span>
<span class="sd">        weldsize(18.0) # returns 6.35 mm</span>

<span class="sd">    Reference: Mott, Table 20-4 Minimum weld sizes for thick plates</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span><span class="o">*</span><span class="mf">25.4</span>
    <span class="n">wa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">5.0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="mf">3.</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="o">/</span><span class="mi">8</span><span class="p">])</span><span class="o">*</span><span class="mf">25.4</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ta</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">wa</span><span class="p">[</span><span class="n">j</span><span class="p">])</span></div>

<span class="k">def</span> <span class="nf">fi</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">j</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>


<div class="viewcode-block" id="alumweldstrength"><a class="viewcode-back" href="../../api.html#melib.library.alumweldstrength">[docs]</a><span class="k">def</span> <span class="nf">alumweldstrength</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">filler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Action</span>
<span class="sd">        Allowable shear stresses for fillet welds on aluminium</span>
<span class="sd">    Arguments</span>
<span class="sd">        `base` : Designation for the metal joined, e.g. `1100`</span>

<span class="sd">        `filler` : Filler alloy number, e.g. `4043`</span>
<span class="sd">    Return</span>
<span class="sd">        Allowable shear stress in MPa</span>
<span class="sd">    Example</span>
<span class="sd">        &gt;&gt;&gt;alumweldstrength(6061, 5356) # returns 48.00 MPa</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fillers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">4043</span><span class="p">,</span> <span class="mi">5356</span><span class="p">,</span> <span class="mi">5556</span><span class="p">])</span>
    <span class="n">metals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">3003</span><span class="p">,</span> <span class="mi">6061</span><span class="p">,</span> <span class="mi">6063</span><span class="p">])</span>
    <span class="n">taua</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                     <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">59</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">45</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">fillers</span><span class="p">,</span> <span class="n">metals</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">fi</span><span class="p">(</span><span class="n">fillers</span><span class="p">,</span> <span class="n">filler</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">fi</span><span class="p">(</span><span class="n">metals</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">taua</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span></div>

<span class="c1"># WELDED STRUCTURES</span>
<div class="viewcode-block" id="ec3cutoff"><a class="viewcode-back" href="../../api.html#melib.library.ec3cutoff">[docs]</a><span class="k">def</span> <span class="nf">ec3cutoff</span><span class="p">(</span><span class="n">detail</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Action</span>
<span class="sd">        Eurocode 3 Cut-off limits for lattice girder joints as per Table 2.4 in Design Guide, Zhao et al</span>
<span class="sd">    Argument</span>
<span class="sd">        `detail` : The Detail category from Table B.2, e.g. `56` for K-joint with overlap</span>
<span class="sd">    Return</span>
<span class="sd">        Cut-off limit (the life is indefinite for stress ranges below this limit)</span>
<span class="sd">    Example</span>
<span class="sd">        &gt;&gt;&gt; ec3cutoff(71)  # returns 32 MPa</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Cut_offs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">90</span><span class="p">:</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">71</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">56</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">50</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">45</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">36</span><span class="p">:</span> <span class="mi">16</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">Cut_offs</span><span class="p">[</span><span class="n">detail</span><span class="p">]</span></div>


<div class="viewcode-block" id="ec3life"><a class="viewcode-back" href="../../api.html#melib.library.ec3life">[docs]</a><span class="k">def</span> <span class="nf">ec3life</span><span class="p">(</span><span class="n">nomstress</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="s2">&quot;CHS&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">        `nomstress` : Nominal stress range, MPa</span>

<span class="sd">        `tr` : Wall thickness ratio (Chord thickness divided by brace thickness)</span>

<span class="sd">        `joint` : &#39;K&#39; or &#39;N&#39;</span>

<span class="sd">        `overlap` : True if overlap joint; False if joint with a gap</span>

<span class="sd">        `section` : Not used.  Only CHS are supported</span>

<span class="sd">    Returns `N`</span>
<span class="sd">        N[0] = Life in cycles for the thickness ratio `tr` as given</span>

<span class="sd">        N[1] = Life in cycles for `tr` as 1.0</span>

<span class="sd">        N[2] = Life in cycles for `tr` as 1.40</span>

<span class="sd">    Example</span>
<span class="sd">        ec3life(120.0, 1.2, joint=&#39;N&#39;)   # returns (80357,25866,134848) cycles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">onelife</span><span class="p">(</span><span class="n">nomstress</span><span class="p">,</span> <span class="n">se</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nomstress</span> <span class="o">&lt;</span> <span class="n">se</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.e8</span><span class="o">*</span><span class="p">(</span><span class="n">se</span><span class="o">/</span><span class="n">nomstress</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span>
    <span class="k">if</span> <span class="n">joint</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;K&quot;</span> <span class="ow">and</span> <span class="n">overlap</span> <span class="ow">and</span> <span class="n">section</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;CHS&quot;</span><span class="p">:</span>
        <span class="p">(</span><span class="n">tboun</span><span class="p">,</span> <span class="n">dc1</span><span class="p">,</span> <span class="n">dc2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.40</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">71</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">joint</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span> <span class="ow">and</span> <span class="n">overlap</span> <span class="ow">and</span> <span class="n">section</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;CHS&quot;</span><span class="p">:</span>
        <span class="p">(</span><span class="n">tboun</span><span class="p">,</span> <span class="n">dc1</span><span class="p">,</span> <span class="n">dc2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">71</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;unsupported E3LIFE call with (joint=</span><span class="si">%s</span><span class="s2">, overlap=</span><span class="si">%s</span><span class="s2">, section=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">joint</span><span class="p">,</span> <span class="n">overlap</span><span class="p">,</span> <span class="n">section</span><span class="p">))</span>
    <span class="n">Se1</span> <span class="o">=</span> <span class="n">ec3cutoff</span><span class="p">(</span><span class="n">dc1</span><span class="p">)</span>
    <span class="n">Se2</span> <span class="o">=</span> <span class="n">ec3cutoff</span><span class="p">(</span><span class="n">dc2</span><span class="p">)</span>  <span class="c1"># Endurance strength when tr&gt;=tboun</span>
    <span class="n">N1</span> <span class="o">=</span> <span class="mf">1.e8</span><span class="o">*</span><span class="p">(</span><span class="n">Se1</span><span class="o">/</span><span class="n">nomstress</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span>
    <span class="n">N2</span> <span class="o">=</span> <span class="mf">1.e8</span><span class="o">*</span><span class="p">(</span><span class="n">Se2</span><span class="o">/</span><span class="n">nomstress</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span>
    <span class="k">if</span> <span class="n">nomstress</span> <span class="o">&lt;</span> <span class="n">Se1</span> <span class="ow">and</span> <span class="n">nomstress</span> <span class="o">&lt;</span> <span class="n">Se2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">tr</span> <span class="o">&gt;</span> <span class="n">tboun</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">onelife</span><span class="p">(</span><span class="n">nomstress</span><span class="p">,</span> <span class="n">Se2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">tr</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nomstress</span> <span class="o">&lt;</span> <span class="n">Se1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">nomstress</span> <span class="o">&lt;</span> <span class="n">Se2</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mf">1.e8</span><span class="o">*</span><span class="p">(</span><span class="n">Se1</span><span class="o">/</span><span class="n">nomstress</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">tr</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tboun</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">-</span><span class="n">N1</span><span class="p">)</span><span class="o">+</span><span class="n">N1</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">onelife</span><span class="p">(</span><span class="n">nomstress</span><span class="p">,</span> <span class="n">Se1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">])</span></div>

<div class="viewcode-block" id="boltgrades"><a class="viewcode-back" href="../../api.html#melib.library.boltgrades">[docs]</a><span class="k">def</span> <span class="nf">boltgrades</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">grade</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">        `x` : Pointer to the bolts sheet in the materials data file</span>

<span class="sd">        `grade` : Bolt grade, e.g. &quot;4.8&quot;</span>

<span class="sd">        `props` : [&quot;Dmin&quot;,&quot;Dmax&quot;,&quot;SUMPA&quot;,&quot;SYMPA&quot;,&quot;PROOF&quot;] or a subset</span>

<span class="sd">    Returns `v`</span>
<span class="sd">        v[0] = Value from the file for &#39;props[0]&#39;</span>

<span class="sd">        v[1] = Value from the file for &#39;props[1]&#39;</span>

<span class="sd">        etc</span>

<span class="sd">    Example</span>
<span class="sd">        x=opendatafiles([&quot;mats&quot;])[0]</span>

<span class="sd">        x.sheet(&quot;bolts&quot;)</span>

<span class="sd">        v=boltgrades(xmat, &quot;4.8&quot;, [&quot;Dmin&quot;, &quot;PROOF&quot;])</span>

<span class="sd">        print(v) # will print &quot;[  1.6 310. ]&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">opendatafiles</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mats&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;bolts&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;bolts&quot;</span><span class="p">)</span>
    
    <span class="n">v</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rnvit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;GRADE &quot;</span><span class="o">+</span><span class="n">grade</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span></div>



<div class="viewcode-block" id="boltpitch"><a class="viewcode-back" href="../../api.html#melib.library.boltpitch">[docs]</a><span class="k">def</span> <span class="nf">boltpitch</span><span class="p">(</span><span class="n">dmajor</span><span class="p">,</span> <span class="n">coarse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">        `dmajor` : Major diameter</span>

<span class="sd">        `coarse` : True if coarse thread; False if fine thread</span>

<span class="sd">    Returns pitch[mm] and stress area[mm2] as a tuple</span>


<span class="sd">    Example</span>

<span class="sd">        (pitch, At)=boltpitch(42, coarse=False) ==&gt; pitch=3, At=1206</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dcoarse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>
                        <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">48</span><span class="p">])</span>
    <span class="n">pcoarse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">35</span><span class="p">,</span> <span class="o">.</span><span class="mi">4</span><span class="p">,</span> <span class="o">.</span><span class="mi">45</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.25</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="n">dfine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">36</span><span class="p">])</span>
    <span class="n">pfine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">35</span><span class="p">,</span> <span class="o">.</span><span class="mi">35</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">75</span><span class="p">,</span>
                      <span class="mi">1</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">coarse</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">dcoarse</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pcoarse</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">dfine</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pfine</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">dmajor</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">At</span> <span class="o">=</span> <span class="n">PIE</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">dmajor</span><span class="o">-</span><span class="mf">0.9382</span><span class="o">*</span><span class="n">pitch</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">At</span><span class="p">)</span></div>


<span class="c1"># ARGUMENTS</span>
<span class="c1"># x : The Xcel pointer to the Belt Data file</span>
<span class="c1"># beltdes: Belt designation, e.g. &quot;3V&quot; or &quot;5V&quot;</span>
<span class="c1"># datumlength[mm] : Length target for the belt</span>
<span class="c1"># RETURNS values read from Optibelt Catalogue Table 25</span>
<span class="c1"># 1: Belt designation, e.g. &quot;3V 1060&quot;</span>
<span class="c1"># 2: Outside length[mm] of this belt designation</span>
<span class="c1"># 3: Length factor, c3</span>
<div class="viewcode-block" id="vbeltlengths"><a class="viewcode-back" href="../../api.html#melib.library.vbeltlengths">[docs]</a><span class="k">def</span> <span class="nf">vbeltlengths</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beltdes</span><span class="o">=</span><span class="s2">&quot;5V&quot;</span><span class="p">,</span> <span class="n">datumlength</span><span class="o">=</span><span class="mf">673.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">        `x` : Xcel pointer to the belts data file</span>

<span class="sd">        `beltdes` : Belt designation, e.g. &quot;3V&quot; or &quot;5V&quot;</span>

<span class="sd">        `datumlength` : Length target for the belt, mm</span>

<span class="sd">    Returns values read from Optibelt Catalogue Table 25</span>

<span class="sd">        [1] = Belt designation, e.g. &quot;3V 1060&quot;</span>

<span class="sd">        [2] = Outside length[mm] of this belt designation</span>

<span class="sd">        [3] = Length factor, c3</span>


<span class="sd">    Example</span>

<span class="sd">        x=opendatafiles([&quot;vbelt&quot;])[0]</span>

<span class="sd">        v=vbeltlengths(x, &quot;5V&quot;, 673.0)</span>

<span class="sd">        print(v) # will print &quot;(&#39;5V 500&#39;, 1270, 0.84)&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="s1">&#39;__vbeltlengths__ (`Xv`, `beltdes`= _ssssss_ , `datumlength`= _nnnnnn_ )</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* Xv : The pointer to the excel file that has data from Optibelt Catalogue Table 24</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* beltdes: Belt designation, e.g. &quot;3V&quot; or &quot;5V&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* datumlength[mm] : Length target for the belt</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;RETURNS (d, L, c3) with</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* d : Belt designation, e.g. &quot;3V 1060&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* L : Outside length[mm] of this belt designation</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* c3 : Length factor, c3</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;_Note_ :</span><span class="se">\n\n</span><span class="s1">* &quot;nnnnnn&quot; is a number</span><span class="se">\n</span><span class="s1">* &quot;ssssss&quot; is a string</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">z</span>

    <span class="n">x</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;LENGTHS&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">maxrow</span><span class="p">()):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">beltdes</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">L</span> <span class="o">&gt;</span> <span class="n">datumlength</span><span class="p">:</span>
                <span class="n">d2</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">c3</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="k">return</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="s2">&quot; </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d2</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">c3</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>
<span class="c1"># ARGUMENTS</span>
<span class="c1"># x : The Xcel pointer to the Belt Data file</span>
<span class="c1"># beltdes: Belt designation, e.g. &quot;3V&quot; or &quot;5V&quot;</span>
<span class="c1"># rpm: Speed of the driving pulley[rpm]</span>
<span class="c1"># dsheave: Diameter of the driving pulley[mm]</span>
<span class="c1"># rat: Speed reduction across this belt transmission stage</span>
<span class="c1"># RETURN values read from Optibelt Table 41(beltdes=3V) or 43(beltdes=5V)</span>
<span class="c1"># 1:PN(Nominal rating,kW) from Optibelt Catalogue Table 41(for 3V) or 43(for 5V)</span>
<span class="c1"># 2:Additional power per belt from Optibelt Catalogue Tables 41 or 43(3V or 5V)</span>


<div class="viewcode-block" id="vbeltpower"><a class="viewcode-back" href="../../api.html#melib.library.vbeltpower">[docs]</a><span class="k">def</span> <span class="nf">vbeltpower</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beltdes</span><span class="o">=</span><span class="s2">&quot;5V&quot;</span><span class="p">,</span> <span class="n">rpm</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">dsheave</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">rat</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">        `x` : Xcel pointer to the belts data file</span>

<span class="sd">        `beltdes` : Belt designation, e.g. &quot;3V&quot; or &quot;5V&quot;</span>

<span class="sd">        `rpm` : Speed of the driving pulley[rpm]</span>

<span class="sd">        `dsheave` : Diameter of the driving pulley[mm]</span>

<span class="sd">        `rat` : Speed reduction across this belt transmission stage</span>

<span class="sd">    Returns values read from Optibelt Table 41(beltdes=3V) or 43(beltdes=5V)</span>

<span class="sd">        [1] = PN(Nominal rating,kW) from Optibelt Catalogue Table 41(for 3V) or 43(for 5V)</span>

<span class="sd">        [2] = Additional power per belt from Optibelt Catalogue Tables 41 or 43(3V or 5V)</span>

<span class="sd">    Example</span>

<span class="sd">        x=opendatafiles([&quot;vbelt&quot;])[0]</span>

<span class="sd">        v=vbeltpower(x, &quot;5V&quot;, rpm=3000, dsheave=100.0, rat=2.0)</span>

<span class="sd">        print(v) # will print &quot;(24.98, 4.47)&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="s1">&#39;__vbeltpower__ (`Xv`, `beltdes`=</span><span class="si">%s</span><span class="s1">, `rpm`=</span><span class="si">%s</span><span class="s1">, `dsheave`=</span><span class="si">%s</span><span class="s1">, `rat`=</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">SVAR</span><span class="p">,</span> <span class="n">NVAR</span><span class="p">,</span> <span class="n">NVAR</span><span class="p">,</span> <span class="n">NVAR</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* `Xv` : The Xcel pointer to the Belt Data file</span><span class="se">\n\</span>
<span class="s1">* `beltdes` : Belt designation, e.g. &quot;3V&quot; or &quot;5V&quot;</span><span class="se">\n\</span>
<span class="s1">* `rpm` : Speed of the driving pulley[rpm]</span><span class="se">\n\</span>
<span class="s1">* `dsheave` : Diameter of the driving pulley[mm]</span><span class="se">\n\</span>
<span class="s1">* `rat` : Speed reduction across this belt transmission stage</span><span class="se">\n\n\</span>
<span class="s1">RETURN values read from Optibelt Tables 41 or 43:</span><span class="se">\n\n\</span>
<span class="s1">* `kw` : PN(Nominal rating,kW) from Optibelt Catalogue Table 41(for 3V) or 43(for 5V)</span><span class="se">\n\</span>
<span class="s1">* `kwadd` : Additional power per belt from Optibelt Catalogue Tables 41 or 43(3V or 5V)</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">z</span>
    <span class="k">if</span> <span class="n">rat</span> <span class="o">&gt;</span> <span class="mf">1.57</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">rat</span> <span class="o">&gt;</span> <span class="mf">1.27</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">rat</span> <span class="o">&gt;</span> <span class="mf">1.06</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">rat</span> <span class="o">&gt;</span> <span class="mf">1.01</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">beltdes</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;3V&quot;</span><span class="p">,</span> <span class="s2">&quot;5V&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;vbeltpower: Unsupported belt designation.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="n">beltdes</span><span class="o">+</span><span class="s2">&quot;POWER&quot;</span><span class="p">)</span>
    <span class="n">ncols</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">dsheave</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">maxrow</span><span class="p">()):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">rpm</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ncols</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">k</span><span class="p">))</span></div>

<span class="c1"># ARGUMENTS</span>
<span class="c1"># x : The Xcel pointer to the Belt Data file</span>
<span class="c1"># d : Diameter of the driving pulley[mm]</span>
<span class="c1"># D : Diameter of the driven pulley[mm]</span>
<span class="c1"># C : Centre distance</span>
<span class="c1"># RETURN</span>
<span class="c1"># 1: Wrap angle beta (for the driving sheave - see Optibelt catalogue p.73)</span>
<span class="c1"># 2: Arc contact correction factor c1 (Optibelt Catalogue Table 22)</span>


<div class="viewcode-block" id="vbeltc1"><a class="viewcode-back" href="../../api.html#melib.library.vbeltc1">[docs]</a><span class="k">def</span> <span class="nf">vbeltc1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">        `x` : Xcel pointer to the belts data file</span>

<span class="sd">        `d` : Diameter of the driving pulley[mm]</span>

<span class="sd">        `D` : Diameter of the driven pulley[mm]</span>

<span class="sd">        `C` : Centre distance[mm]</span>

<span class="sd">    Returns</span>

<span class="sd">        [1] = Wrap angle beta (for the driving sheave - see Optibelt catalogue p.73)</span>

<span class="sd">        [2] = Arc contact correction factor c1 (Optibelt Catalogue Table 22)</span>

<span class="sd">    Example</span>

<span class="sd">        x=opendatafiles([&quot;vbelt&quot;])[0]</span>

<span class="sd">        v=vbeltc1(x, 75, 230, 420)</span>

<span class="sd">        print(v) # will print &quot;(156.0, 0.99)&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;BETA&quot;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="n">C</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">maxrow</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">s</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span></div>

<span class="c1">#</span>
<span class="c1"># GEAR FUNCTIONS</span>

<div class="viewcode-block" id="geartip"><a class="viewcode-back" href="../../api.html#melib.library.geartip">[docs]</a><span class="k">def</span> <span class="nf">geartip</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with `dp` =pitch diameter and `m` =module both expressed using the same units</span>
<span class="sd">        , e.g. mm.  The function returns the tip radius.  It is assumed that the</span>
<span class="sd">        addendum is equal to the module.</span>

<span class="sd">        **Example** : ``geartip(168, 8)`` --&gt; `184`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dp</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span>  <span class="c1"># Assumes ADDENDUM=m</span></div>


<div class="viewcode-block" id="mintoothnum"><a class="viewcode-back" href="../../api.html#melib.library.mintoothnum">[docs]</a><span class="k">def</span> <span class="nf">mintoothnum</span><span class="p">(</span><span class="n">phi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``phi`` as the pressure angle in degrees. Returns the minimum</span>
<span class="sd">        number of teeth allowed on the pinion to prevent interference when driving</span>
<span class="sd">        a rack.  The pressure angles of 14.5, 20, and 12 are supported. Reference is</span>
<span class="sd">        Mott, Table 8-7.</span>

<span class="sd">        **Example** : ``mintoothnum(20)`` --&gt; `18`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MINTOOTHNUM</span> <span class="o">=</span> <span class="p">{</span><span class="mf">14.5</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">20</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">25</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">MINTOOTHNUM</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">MINTOOTHNUM</span><span class="p">[</span><span class="n">phi</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;MINTOOTHNUM error - Wrong pressure angle (</span><span class="si">%.1f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">phi</span><span class="p">)</span></div>


<div class="viewcode-block" id="huntingteeth"><a class="viewcode-back" href="../../api.html#melib.library.huntingteeth">[docs]</a><span class="k">def</span> <span class="nf">huntingteeth</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="n">Ng</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is used by the auto marker.</span>

<span class="sd">        When the number of teeth on a pinion and the gear has common multiples,</span>
<span class="sd">        there may be preferential matching between gears and this would cause</span>
<span class="sd">        premature wear.  When called with ``Np`` and ``Ng`` as the numbers of</span>
<span class="sd">        teeth on the pinion and the gear, respectively, this function returns</span>

<span class="sd">            0 if ``Ng`` is an integer multiple of ``Np``</span>

<span class="sd">            0.5  if there is at least one common multiple, e.g. both are even numbers</span>

<span class="sd">            1 if there are no common multiples</span>

<span class="sd">            **Examples**</span>
<span class="sd">                ``huntingteeth(23,46)`` --&gt; `0`</span>

<span class="sd">                ``huntingteeth(22,46)`` --&gt; `0.5`</span>

<span class="sd">                ``huntingteeth(23,47)`` --&gt; `1`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Np</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Np</span><span class="p">)</span>
    <span class="n">Ng</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Ng</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Ng</span><span class="o">/</span><span class="n">Np</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Ng</span> <span class="o">==</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">Np</span><span class="p">)):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Np</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Ng</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.5</span>
    <span class="k">return</span> <span class="mi">1</span></div>

<span class="c1"># ARGUMENTS:</span>
<span class="c1"># bhn: Brinelll hardness</span>
<span class="c1"># grade: Gear Material grade (1 or 2; default=1)</span>
<span class="c1"># RETURN:</span>
<span class="c1"># (Sat, Sac): Allowable (bending, contact) strength numbers[MPa]</span>


<div class="viewcode-block" id="agmastrength"><a class="viewcode-back" href="../../api.html#melib.library.agmastrength">[docs]</a><span class="k">def</span> <span class="nf">agmastrength</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">grade</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this function with ``h`` as the Brinell hardness of the gear</span>
<span class="sd">        material and it will return the AGMA allowable bending and contact</span>
<span class="sd">        stress numbers for Grade 1 AGMA materials.</span>

<span class="sd">        The reference is the `AGMA 2001-D04`, e.g. as in Mott Figs</span>
<span class="sd">        9.11 and 9.12.  AGMA does not allowable extrapolation for hardness values</span>
<span class="sd">        above 400HB.</span>

<span class="sd">        **Examples**</span>
<span class="sd">            ``agmastrength(400)`` --&gt; `(301.5, 1088.6)`</span>

<span class="sd">            ``agmastrength(600)`` --&gt; `(301.5, 1088.6)`</span>

<span class="sd">            ``agmastrength(300)`` --&gt; `(248.2, 866.6)`</span>

<span class="sd">        You may specify Grade 2 by using the argument ``grade``, e.g.</span>
<span class="sd">        ``agmastrength(300, grade=2)`` returns `(324.0, 959.5)`.</span>

<span class="sd">        If a surface treatment is specified by using the argument ``surface``,</span>
<span class="sd">        the strength is adjusted accordingly by using the AGMA recommendations as</span>
<span class="sd">        tabulated in Mott, Table 9-5.</span>

<span class="sd">        The allowable surface modifications are &#39;flame hardened&#39; and</span>
<span class="sd">        &#39;carburised&#39;.  The default is no surface modification.</span>

<span class="sd">        **Examples**</span>
<span class="sd">            ``agmastrength(300, surface=&quot;flame hardened&quot;)`` --&gt; `(310, 1207)`</span>

<span class="sd">            ``agmastrength(300, surface=&quot;carburised&quot;)`` --&gt; `(379, 1241)`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">h</span><span class="o">&gt;</span><span class="mi">400</span><span class="p">:</span>
        <span class="n">h</span><span class="o">=</span><span class="mi">400</span>
    <span class="k">if</span> <span class="n">surface</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
        <span class="n">bhn</span> <span class="o">=</span> <span class="n">h</span>
        <span class="k">if</span> <span class="n">grade</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Sat</span> <span class="o">=</span> <span class="mf">0.533</span><span class="o">*</span><span class="n">bhn</span><span class="o">+</span><span class="mf">88.26</span>
            <span class="n">Sac</span> <span class="o">=</span> <span class="mf">2.22</span><span class="o">*</span><span class="n">bhn</span><span class="o">+</span><span class="mf">200.6</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
                <span class="n">CALCRECORD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0.533*</span><span class="si">%.0f</span><span class="s2">+88.26&quot;</span> <span class="o">%</span> <span class="n">bhn</span>
                <span class="n">CALCRECORD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2.22*</span><span class="si">%.0f</span><span class="s2">+200.6&quot;</span> <span class="o">%</span> <span class="n">bhn</span>
        <span class="k">elif</span> <span class="n">grade</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Sat</span> <span class="o">=</span> <span class="mf">0.703</span><span class="o">*</span><span class="n">bhn</span><span class="o">+</span><span class="mf">113.1</span>
            <span class="n">Sac</span> <span class="o">=</span> <span class="mf">2.41</span><span class="o">*</span><span class="n">bhn</span><span class="o">+</span><span class="mf">236.5</span>
            <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
                <span class="n">CALCRECORD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0.703*</span><span class="si">%.0f</span><span class="s2">+113.1&quot;</span> <span class="o">%</span> <span class="n">bhn</span>
                <span class="n">CALCRECORD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2.41*</span><span class="si">%.0f</span><span class="s2">+236.5&quot;</span> <span class="o">%</span> <span class="n">bhn</span>
    <span class="k">elif</span> <span class="n">grade</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;AGMASTRENGTH: Surface hardening allowed only for Grade 1.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Surface hardening:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">surface</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">hrc</span> <span class="o">=</span> <span class="n">h</span>
        <span class="k">if</span> <span class="n">hrc</span> <span class="o">&gt;</span> <span class="mi">54</span><span class="p">:</span>
            <span class="n">hrc</span> <span class="o">=</span> <span class="mi">54</span>
        <span class="k">if</span> <span class="n">surface</span> <span class="o">==</span> <span class="s2">&quot;flame hardened&quot;</span><span class="p">:</span>
            <span class="n">Sat</span> <span class="o">=</span> <span class="mi">310</span>
            <span class="k">if</span> <span class="n">hrc</span> <span class="o">==</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">Sac</span> <span class="o">=</span> <span class="mi">1172</span>
            <span class="k">elif</span> <span class="n">hrc</span> <span class="o">==</span> <span class="mi">54</span><span class="p">:</span>
                <span class="n">Sac</span> <span class="o">=</span> <span class="mi">1207</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;AGMASTRENGTH: Only 50HRC or 54HRC allowed&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">surface</span> <span class="o">==</span> <span class="s2">&quot;carburised&quot;</span><span class="p">:</span>
            <span class="n">Sat</span> <span class="o">=</span> <span class="mi">379</span>
            <span class="n">Sac</span> <span class="o">=</span> <span class="mi">1241</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;AGMASTRENGTH: Unknown surface treatment(&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="n">surface</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Sat</span><span class="p">,</span> <span class="n">Sac</span><span class="p">)</span></div>

<span class="c1"># ARGUMENTS:</span>
<span class="c1"># r: Desired reliabilityy, e.g. 0.99 for 99%</span>
<span class="c1"># RETURN:</span>
<span class="c1"># KR: Reliability factor</span>


<div class="viewcode-block" id="agmaKR"><a class="viewcode-back" href="../../api.html#melib.library.agmaKR">[docs]</a><span class="k">def</span> <span class="nf">agmaKR</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``r`` as the required reliability and the function will return</span>
<span class="sd">        the corresponding AGMA reliability factor KR.</span>

<span class="sd">        **Example** ``agmaKR(0.98)`` --&gt; `0.98333`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mf">0.9999</span><span class="p">]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">]</span>
    <span class="c1"># K=0.70 for R=0.50 but I will not allow using R&lt;0.90.  If they do, K will</span>
    <span class="c1"># be that for R=0.90</span>
    <span class="n">Kr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Kr</span></div>


<span class="c1"># Called by agmaJ().</span>
<span class="k">def</span> <span class="nf">J2</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
    <span class="c1"># The starting point for the following tables are Collins, Mechanical Design</span>
    <span class="c1"># I added them points using the Mott Figure 9-15(b)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">135</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">135</span><span class="p">])</span>
    <span class="c1"># a[row,col] is the J for N1=x[col] and N2=y[row]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>  <span class="c1"># N1</span>
        <span class="p">[</span><span class="mf">0.289</span><span class="p">,</span>  <span class="mf">0.315</span><span class="p">,</span>    <span class="mf">0.326</span><span class="p">,</span> <span class="mf">0.347</span><span class="p">,</span> <span class="mf">0.356</span><span class="p">,</span>  <span class="mf">0.378</span><span class="p">,</span> <span class="mf">0.415</span><span class="p">,</span> <span class="mf">0.447</span><span class="p">],</span>  <span class="c1"># 17</span>
        <span class="p">[</span><span class="mf">0.289</span><span class="p">,</span>  <span class="mf">0.316</span><span class="p">,</span>    <span class="mf">0.326</span><span class="p">,</span> <span class="mf">0.348</span><span class="p">,</span> <span class="mf">0.357</span><span class="p">,</span>  <span class="mf">0.380</span><span class="p">,</span> <span class="mf">0.417</span><span class="p">,</span> <span class="mf">0.448</span><span class="p">],</span>  <span class="c1"># 19</span>
        <span class="p">[</span><span class="mf">0.289</span><span class="p">,</span>  <span class="mf">0.317</span><span class="p">,</span>    <span class="mf">0.327</span><span class="p">,</span> <span class="mf">0.349</span><span class="p">,</span> <span class="mf">0.358</span><span class="p">,</span>  <span class="mf">0.381</span><span class="p">,</span> <span class="mf">0.418</span><span class="p">,</span> <span class="mf">0.450</span><span class="p">],</span>  <span class="c1"># 21</span>
        <span class="p">[</span><span class="mf">0.289</span><span class="p">,</span>  <span class="mf">0.319</span><span class="p">,</span>    <span class="mf">0.330</span><span class="p">,</span> <span class="mf">0.351</span><span class="p">,</span> <span class="mf">0.360</span><span class="p">,</span>  <span class="mf">0.384</span><span class="p">,</span> <span class="mf">0.422</span><span class="p">,</span> <span class="mf">0.454</span><span class="p">],</span>  <span class="c1"># 26</span>
        <span class="p">[</span><span class="mf">0.289</span><span class="p">,</span>  <span class="mf">0.321</span><span class="p">,</span>    <span class="mf">0.332</span><span class="p">,</span> <span class="mf">0.353</span><span class="p">,</span> <span class="mf">0.363</span><span class="p">,</span>  <span class="mf">0.387</span><span class="p">,</span> <span class="mf">0.425</span><span class="p">,</span> <span class="mf">0.458</span><span class="p">],</span>  <span class="c1"># 29</span>
        <span class="p">[</span><span class="mf">0.289</span><span class="p">,</span>  <span class="mf">0.325</span><span class="p">,</span>    <span class="mf">0.336</span><span class="p">,</span> <span class="mf">0.358</span><span class="p">,</span> <span class="mf">0.367</span><span class="p">,</span>  <span class="mf">0.392</span><span class="p">,</span> <span class="mf">0.431</span><span class="p">,</span> <span class="mf">0.465</span><span class="p">],</span>  <span class="c1"># 35</span>
        <span class="p">[</span><span class="mf">0.289</span><span class="p">,</span>  <span class="mf">0.333</span><span class="p">,</span>    <span class="mf">0.343</span><span class="p">,</span> <span class="mf">0.366</span><span class="p">,</span> <span class="mf">0.376</span><span class="p">,</span>  <span class="mf">0.402</span><span class="p">,</span> <span class="mf">0.444</span><span class="p">,</span> <span class="mf">0.480</span><span class="p">],</span>  <span class="c1"># 55</span>
        <span class="p">[</span><span class="mf">0.289</span><span class="p">,</span>  <span class="mf">0.339</span><span class="p">,</span>    <span class="mf">0.351</span><span class="p">,</span> <span class="mf">0.376</span><span class="p">,</span> <span class="mf">0.387</span><span class="p">,</span>  <span class="mf">0.414</span><span class="p">,</span> <span class="mf">0.460</span><span class="p">,</span> <span class="mf">0.499</span><span class="p">]])</span>  <span class="c1"># 135</span>
<span class="c1"># N2    7      19         21    26     29       35     55     135</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fp</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># ARGUMENTS</span>
<span class="c1"># sdrive: The drive description, e.g. &quot;UNIFORM&quot;, &quot;LIGHT SHOCK&quot;, ...</span>
<span class="c1"># sload: The load description, e.g.  &quot;UNIFORM&quot;, &quot;LIGHT SHOCK&quot;, ...</span>
<span class="c1"># RETURN</span>
<span class="c1"># The Overload factor, Ko</span>


<div class="viewcode-block" id="agmaKo"><a class="viewcode-back" href="../../api.html#melib.library.agmaKo">[docs]</a><span class="k">def</span> <span class="nf">agmaKo</span><span class="p">(</span><span class="n">sdrive</span><span class="p">,</span> <span class="n">sload</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``sdrive`` describing the drive characteristics and ``sload``</span>
<span class="sd">        representing the load characteristics and the function will return the</span>
<span class="sd">        AGMA overload factor Ko.  The acceptable values are:</span>

<span class="sd">        ``sdrive : [&quot;UNIFORM&quot;, &quot;LIGHT SHOCK&quot;, &quot;MODERATE SHOCK&quot;]``</span>

<span class="sd">        ``sload : [&quot;UNIFORM&quot;, &quot;LIGHT SHOCK&quot;, &quot;MODERATE SHOCK&quot;, &quot;HEAVY SHOCK&quot;]``</span>

<span class="sd">        **Example** ``agmaKo(&quot;light shock&quot;, &quot;uniform&quot;)`` --&gt; `1.2`</span>

<span class="sd">        The arguments are case-insensitive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sdrive</span> <span class="o">=</span> <span class="n">sdrive</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">sload</span> <span class="o">=</span> <span class="n">sload</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">load</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;UNIFORM&quot;</span><span class="p">,</span> <span class="s2">&quot;LIGHT SHOCK&quot;</span><span class="p">,</span> <span class="s2">&quot;MODERATE SHOCK&quot;</span><span class="p">,</span> <span class="s2">&quot;HEAVY SHOCK&quot;</span><span class="p">]</span>
    <span class="n">drive</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;UNIFORM&quot;</span><span class="p">,</span> <span class="s2">&quot;LIGHT SHOCK&quot;</span><span class="p">,</span> <span class="s2">&quot;MODERATE SHOCK&quot;</span><span class="p">]</span>
    <span class="n">Ko</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">]]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">drive</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sdrive</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sload</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Ko</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span></div>

<span class="c1"># ARGUMENTS</span>
<span class="c1"># m:module[mm]</span>
<span class="c1"># RETURN</span>
<span class="c1"># The size factor Ks</span>


<div class="viewcode-block" id="agmaKs"><a class="viewcode-back" href="../../api.html#melib.library.agmaKs">[docs]</a><span class="k">def</span> <span class="nf">agmaKs</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">        Call with ``m`` as the gear module in `mm` and the function will return</span>
<span class="sd">        the AGMA shape factor ``Ks``.</span>

<span class="sd">        **Example** ``agmaKs(8)`` --&gt; `1.15`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.40</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;$K_s(Module=</span><span class="si">%.0f</span><span class="s2">)=</span><span class="si">%.2f</span><span class="s2">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z</span></div>

<span class="c1"># ARGUMENTS</span>
<span class="c1"># fw : Face width[mm]</span>
<span class="c1"># d: Pitch diameter[mm]</span>
<span class="c1"># gearbox: The application type (&quot;Open&quot;, &quot;Commercial enclosed units&quot;, etc.)</span>


<span class="k">def</span> <span class="nf">_agmaKm</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gearbox</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">fw</span><span class="o">/</span><span class="mf">25.4</span>
    <span class="n">Dp</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="mf">25.4</span>
    <span class="k">if</span> <span class="n">Dp</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.e6</span>
    <span class="c1"># Load distribution factor</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">F</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="n">Cpf</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">Dp</span><span class="p">)</span><span class="o">-</span><span class="mf">0.025</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;$C_</span><span class="si">{pf}</span><span class="s2">=</span><span class="se">\\</span><span class="s2">frac{</span><span class="si">%.0f</span><span class="s2">/25.4}{10</span><span class="si">%.0f</span><span class="s2">/25.4}-0.025$=</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">fw</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">Cpf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Cpf</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">Dp</span><span class="p">)</span><span class="o">-</span><span class="mf">0.0375</span><span class="o">+</span><span class="mf">0.0125</span><span class="o">*</span><span class="n">F</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;$C_</span><span class="si">{pf}</span><span class="s2">=</span><span class="se">\\</span><span class="s2">frac{</span><span class="si">%.0f</span><span class="s2">}{10</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">}-0.0375+0.0125</span><span class="se">\\</span><span class="s2">frac{</span><span class="si">%.0f</span><span class="s2">}</span><span class="si">{25.4}</span><span class="s2">$=</span><span class="si">%.4f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">fw</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">fw</span><span class="p">,</span> <span class="n">Cpf</span><span class="p">)</span>
<span class="c1">#        print (&quot;Cpf=%f&quot;%Cpf)</span>
    <span class="n">applic_type</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;open gearing&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;commercial enclosed units&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;extra precision&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">applic_type</span><span class="p">[</span><span class="n">gearbox</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.247</span><span class="p">,</span>   <span class="mf">0.127</span><span class="p">,</span>  <span class="mf">0.0675</span><span class="p">,</span> <span class="mf">0.0380</span><span class="p">]</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0167</span><span class="p">,</span>  <span class="mf">0.0158</span><span class="p">,</span> <span class="mf">0.0128</span><span class="p">,</span> <span class="mf">0.0102</span><span class="p">]</span>
    <span class="n">C2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.765</span><span class="p">,</span>  <span class="o">-</span><span class="mf">1.093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.926</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.822</span><span class="p">]</span>
    <span class="n">Cma</span> <span class="o">=</span> <span class="n">C0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">C1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">F</span><span class="o">+</span><span class="n">C2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="mf">1.0e-4</span><span class="o">*</span><span class="n">F</span><span class="o">*</span><span class="n">F</span>
    <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;$C_</span><span class="si">{ma}</span><span class="s2">=</span><span class="si">%.4f</span><span class="s2">+</span><span class="si">%.4f</span><span class="se">\\</span><span class="s2">frac{</span><span class="si">%.0f</span><span class="s2">}</span><span class="si">{25.4}%.4f</span><span class="se">\\</span><span class="s2">times10^{-4}(</span><span class="se">\\</span><span class="s2">frac{</span><span class="si">%.0f</span><span class="s2">}</span><span class="si">{25.4}</span><span class="s2">)^2=</span><span class="si">%.4f</span><span class="se">\</span>
<span class="s2">$</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">C0</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">C1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fw</span><span class="p">,</span> <span class="n">C2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fw</span><span class="p">,</span> <span class="n">Cma</span><span class="p">)</span>
    <span class="n">Km</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">Cpf</span><span class="o">+</span><span class="n">Cma</span><span class="p">)</span>
    <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;$K_m=1.0+</span><span class="si">%.4f</span><span class="s2">+</span><span class="si">%.4f</span><span class="s2">=</span><span class="si">%.2f</span><span class="s2">$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Cpf</span><span class="p">,</span> <span class="n">Cma</span><span class="p">,</span> <span class="n">Km</span><span class="p">)</span>
<span class="c1">#        print(&quot;Cma=%f&quot;%Cma)</span>
    <span class="k">return</span> <span class="n">Km</span>


<div class="viewcode-block" id="agmaKm"><a class="viewcode-back" href="../../api.html#melib.library.agmaKm">[docs]</a><span class="k">def</span> <span class="nf">agmaKm</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gearbox</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``fw`` as the face width in `mm`, ``d`` as the pinion</span>
<span class="sd">        diameter in `mm`, and the ``gearbox`` describing the application,</span>
<span class="sd">        the function returns the AGMA load distribution factor ``Km``.</span>

<span class="sd">        The allowable values for the case-insensitive string ``gearbox`` are</span>

<span class="sd">            ``&quot;open gearing&quot;``</span>

<span class="sd">            ``&quot;commercial enclosed units&quot;``</span>

<span class="sd">            ``&quot;precision&quot;``</span>

<span class="sd">            ``&quot;extra precision&quot;``</span>

<span class="sd">        **Example** ``agmaKm(80, 160, &quot;commercial enclosed units&quot;)`` --&gt; `1.2275`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fw</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">Km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fw</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fw</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">Km</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_agmaKm</span><span class="p">(</span><span class="n">fw</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gearbox</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">fw</span><span class="p">):</span>
                <span class="n">Km</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Km</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Km</span> <span class="o">=</span> <span class="n">_agmaKm</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">gearbox</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Km</span></div>


<div class="viewcode-block" id="agmaKB"><a class="viewcode-back" href="../../api.html#melib.library.agmaKB">[docs]</a><span class="k">def</span> <span class="nf">agmaKB</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>  <span class="c1"># m: module[mm], t:rim thickness[</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``m`` as the gear module in `mm` and ``t`` as the rim</span>
<span class="sd">        thickness in `mm`.The returned value is</span>
<span class="sd">        the AGMA rim thickness factor, ``KB``.</span>

<span class="sd">        For solid gear blanks, use the gear pitch radius as the rim</span>
<span class="sd">        thickness and the function will return 1.</span>

<span class="sd">        The function will return a value less than 1 only when the rim thickness</span>
<span class="sd">        is low.  Modern gears can usually be designed to deliver a rim</span>
<span class="sd">        thickness factor of 1.0.</span>

<span class="sd">        **Example** ``agmaKB(3,25)`` --&gt; `1.0`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">2.2</span><span class="o">*</span><span class="n">m</span>
    <span class="n">mB</span> <span class="o">=</span> <span class="n">t</span><span class="o">/</span><span class="n">h</span>
    <span class="k">if</span> <span class="n">mB</span> <span class="o">&gt;</span> <span class="mf">1.2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.0</span>
    <span class="k">elif</span> <span class="n">mB</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.6</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.242</span><span class="o">/</span><span class="n">mB</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.6</span></div>



<div class="viewcode-block" id="agmaKv"><a class="viewcode-back" href="../../api.html#melib.library.agmaKv">[docs]</a><span class="k">def</span> <span class="nf">agmaKv</span><span class="p">(</span><span class="n">agmanumber</span><span class="p">,</span> <span class="n">vt</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``agmanumber`` as the AGMA quality number (e.g. &quot;A10&quot;) and</span>
<span class="sd">        ``vt`` as the pitch line linear velocity</span>

<span class="sd">            Pitch line velocity[m/s] = angular speed[rad/s] * pitch radius[m]</span>

<span class="sd">        The returned value is the AGMA dynamic factor ``Kv``</span>

<span class="sd">        **Example** : ``agmaKv(&quot;A11&quot;, 10)`` --&gt; `1.582`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">agmanumber</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">agmanumber</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">agmanumber</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.1</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mf">5.0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.667</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mf">3.5637</span><span class="o">+</span><span class="mf">3.9914</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">B</span><span class="p">)</span>
    <span class="n">kv</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">/</span><span class="p">(</span><span class="n">C</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vt</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">B</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;$B=0.25(</span><span class="si">%.0f</span><span class="s2">-5.0)^</span><span class="si">{0.667}</span><span class="s2">=</span><span class="si">%.4f</span><span class="s2">$</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;$C=3.5637+3.9914</span><span class="se">\\</span><span class="s2">times(1-B)=</span><span class="si">%.4f</span><span class="s2">$</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">C</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;$K_v=</span><span class="se">\\</span><span class="s2">frac</span><span class="si">{C}</span><span class="s2">{C+</span><span class="se">\\</span><span class="s2">sqrt{</span><span class="si">%.1f</span><span class="s2">}}^{-B}=</span><span class="si">%.2f</span><span class="s2">$</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">kv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kv</span></div>


<span class="c1"># ARGUMENTS:</span>
<span class="c1"># Np: Number of teeth on the pinion</span>
<span class="c1"># Ng: Number of teeth on the gear</span>
<span class="c1"># RETURN</span>
<span class="c1"># AGMA Bending Geometry Factor (J) values for the pinion and the gear</span>
<div class="viewcode-block" id="agmaJ"><a class="viewcode-back" href="../../api.html#melib.library.agmaJ">[docs]</a><span class="k">def</span> <span class="nf">agmaJ</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="n">Ng</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``Np`` and ``Ng`` as the numbers of teeth for the pinion and</span>
<span class="sd">        the gear, respectively.  The returned value is the AGMA Bending Geometry</span>
<span class="sd">        Factors, Jp and Jg, for the pinion and the gear, respectively.</span>

<span class="sd">        **Example** ``agmaJ(17, 41)``--&gt;&gt; `(0.2890, 0.3891)`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Jp</span> <span class="o">=</span> <span class="n">J2</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="n">Ng</span><span class="p">)</span>
    <span class="n">Jg</span> <span class="o">=</span> <span class="n">J2</span><span class="p">(</span><span class="n">Ng</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Jp</span><span class="p">,</span> <span class="n">Jg</span><span class="p">)</span></div>

<span class="c1"># ARGUMENTS:</span>
<span class="c1"># Np: Number of teeth on the pinion</span>
<span class="c1"># Ng: Number of teeth on the gear</span>
<span class="c1"># RETURN</span>
<span class="c1"># AGMA Contact Geometry Factor (I) (the same for the pinion and the gear)</span>


<div class="viewcode-block" id="agmaI"><a class="viewcode-back" href="../../api.html#melib.library.agmaI">[docs]</a><span class="k">def</span> <span class="nf">agmaI</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="n">Ng</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``Np`` and ``Ng`` as the numbers of teeth for the pinion and</span>
<span class="sd">        the gear, respectively.  The returned value is the AGMA Contact Geometry</span>
<span class="sd">        Factor, I.  Note that I is the same for the pinion and the gear.</span>

<span class="sd">        **Example** ``agmaI(17, 41)``--&gt;&gt; `0.094356`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="n">mG</span> <span class="o">=</span> <span class="n">Ng</span><span class="o">/</span><span class="n">Np</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mf">20.0</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">Cc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">mG</span><span class="o">/</span><span class="p">(</span><span class="n">mG</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="n">Np</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">C2</span> <span class="o">=</span> <span class="n">C1</span><span class="o">*</span><span class="n">mG</span>
    <span class="n">C3</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Np</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="n">Np</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Np</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="n">Np</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">C4</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="n">Cx</span> <span class="o">=</span> <span class="p">((</span><span class="n">C1</span><span class="o">-</span><span class="n">C3</span><span class="o">+</span><span class="n">C4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">C2</span><span class="o">+</span><span class="n">C3</span><span class="o">-</span><span class="n">C4</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">C1</span><span class="o">*</span><span class="n">C2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Cc</span><span class="o">*</span><span class="n">Cx</span></div>

<span class="c1"># ARGUMENTS:</span>
<span class="c1"># NC : Design life in terms of the number of cycles</span>
<span class="c1"># HB : Brinell Hardness</span>
<span class="c1"># surface = Surface hardness, e.g. &quot;case&quot; or &quot;nitrided&quot;; default is None</span>
<span class="c1"># RETURN</span>
<span class="c1"># Bending strength life adjustment factor, YN</span>


<div class="viewcode-block" id="agmayn"><a class="viewcode-back" href="../../api.html#melib.library.agmayn">[docs]</a><span class="k">def</span> <span class="nf">agmayn</span><span class="p">(</span><span class="n">Nc</span><span class="p">,</span> <span class="n">HB</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>  <span class="c1"># Nc:Nof cycles; HB:Brinell; surface:surface hardening</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``Nc`` as tooth design life in terms of number of cycles, ``HB`` the</span>
<span class="sd">        Brinell hardness, and ``surface`` the surface condition.  The default surface</span>
<span class="sd">        condition is none; the allowable choices are &quot;nitrided&quot; and &quot;case&quot; (short for case-carburised)</span>

<span class="sd">        The returned value is the AGMA Bending Stress cycle factor, YN.</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; agmayn(1.e8)</span>
<span class="sd">            &gt;&gt;&gt; 0.9767774605590424</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="c1"># print(type(Nc))</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Nc</span><span class="p">))</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Nc</span><span class="p">)):</span>
            <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">agmayn</span><span class="p">(</span><span class="n">Nc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">HB</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">z</span>
    <span class="k">if</span> <span class="n">Nc</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">Nc</span> <span class="o">&gt;</span> <span class="mf">4e6</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.3558</span><span class="o">/</span><span class="n">Nc</span><span class="o">**</span><span class="mf">0.0178</span>
    <span class="k">if</span> <span class="n">surface</span> <span class="o">==</span> <span class="s2">&quot;case&quot;</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="mf">6.1514</span><span class="o">/</span><span class="mi">1000</span><span class="o">**</span><span class="mf">0.1192</span>
    <span class="k">elif</span> <span class="n">surface</span> <span class="o">==</span> <span class="s2">&quot;nitrided&quot;</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="mf">3.517</span><span class="o">/</span><span class="mi">1000</span><span class="o">**</span><span class="mf">0.0817</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.3194</span><span class="o">/</span><span class="mi">1000</span><span class="o">**</span><span class="mf">0.0538</span><span class="p">,</span> <span class="mf">4.9404</span> <span class="o">/</span>
                      <span class="mi">1000</span><span class="o">**</span><span class="mf">0.1045</span><span class="p">,</span> <span class="mf">9.4518</span><span class="o">/</span><span class="mi">1000</span><span class="o">**</span><span class="mf">0.148</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">160.0</span><span class="p">,</span>                <span class="mf">250.0</span><span class="p">,</span>               <span class="mf">400.0</span><span class="p">])</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">HB</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">-</span><span class="mf">1.04</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">/</span><span class="mf">4.0e6</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">C</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">m</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Nc</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="p">)</span></div>

<span class="c1"># ARGUMENTS:</span>
<span class="c1"># NC : Design life in terms of the number of cycles</span>
<span class="c1"># HB : Brinell Hardness</span>
<span class="c1"># surface = Surface hardness, e.g. &quot;nitrided&quot;; default is None</span>
<span class="c1"># RETURN</span>
<span class="c1"># Contact strength life adjustment factor, ZN</span>


<div class="viewcode-block" id="agmazn"><a class="viewcode-back" href="../../api.html#melib.library.agmazn">[docs]</a><span class="k">def</span> <span class="nf">agmazn</span><span class="p">(</span><span class="n">Nc</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>  <span class="c1"># Nc:Nof cycles; surface:surface hardening</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``Nc`` as tooth design life in terms of number of cycles, ``HB`` the</span>
<span class="sd">        Brinell hardness, and ``surface`` the surface condition.  The default surface</span>
<span class="sd">        condition is none; the only other choice is &quot;nitrided&quot;</span>

<span class="sd">        The returned value is the AGMA Pitting resistance stress cycle factor, ZN.</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; agmazn(1.e8)</span>
<span class="sd">            &gt;&gt;&gt; 0.9484368889886681</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Nc</span><span class="p">))</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Nc</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Nc</span><span class="p">)):</span>
            <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">agmazn</span><span class="p">(</span><span class="n">Nc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">z</span>

    <span class="k">if</span> <span class="n">Nc</span> <span class="o">&lt;</span> <span class="mf">4e6</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">surface</span> <span class="o">==</span> <span class="s2">&quot;nitrided&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">Nc</span> <span class="o">&lt;</span> <span class="mf">1e7</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">surface</span> <span class="o">==</span> <span class="s2">&quot;nitrided&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.249</span><span class="o">/</span><span class="n">Nc</span><span class="o">**</span><span class="mf">0.0138</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">2.466</span><span class="o">/</span><span class="n">Nc</span><span class="o">**</span><span class="mf">0.056</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.4488</span><span class="o">/</span><span class="n">Nc</span><span class="o">**</span><span class="mf">0.023</span></div>




<span class="c1">#</span>
<span class="c1"># SHAFT FUNCTIONS</span>
<span class="c1">#</span>
<span class="c1">#</span>
<div class="viewcode-block" id="shaftendur"><a class="viewcode-back" href="../../api.html#melib.library.shaftendur">[docs]</a><span class="k">def</span> <span class="nf">shaftendur</span><span class="p">(</span><span class="n">uts</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;ground&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call with ``uts`` = Tensile strength[MPa] and ``condition`` = a string describing</span>
<span class="sd">        the surface condition.  The returned value is the endurance strength</span>
<span class="sd">        read off the following chart:</span>

<span class="sd">        .. image:: ../../assets/shaftendur.png</span>

<span class="sd">        The valid options for the second argument are:</span>

<span class="sd">            * ``&#39;ground&#39;`` (default)</span>
<span class="sd">            * ``&#39;polished&#39;``</span>
<span class="sd">            * ``&#39;cold drawn&#39;``</span>
<span class="sd">            * ``&#39;machined&#39;`` (equivalent to ``&#39;cold drawn&#39;`` )</span>
<span class="sd">            * ``&#39;hot rolled&#39;``</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; shaftendur(900,&#39;hot rolled&#39;)</span>
<span class="sd">            &gt;&gt;&gt; 212.5</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">condition</span> <span class="o">==</span> <span class="s2">&quot;ground&quot;</span><span class="p">:</span>
        <span class="n">su</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">350</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">875</span><span class="p">,</span> <span class="mi">1050</span><span class="p">,</span> <span class="mi">1250</span><span class="p">,</span> <span class="mi">1450</span><span class="p">,</span> <span class="mi">1500</span><span class="p">])</span>
        <span class="n">sn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">137</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">297</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">478</span><span class="p">,</span>  <span class="mi">553</span><span class="p">,</span>  <span class="mi">600</span><span class="p">,</span>  <span class="mi">612</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">uts</span><span class="p">,</span> <span class="n">su</span><span class="p">,</span> <span class="n">sn</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">condition</span> <span class="o">==</span> <span class="s2">&quot;polished&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.50</span><span class="o">*</span><span class="n">uts</span>
    <span class="k">elif</span> <span class="n">condition</span> <span class="o">==</span> <span class="s2">&quot;cold drawn&quot;</span> <span class="ow">or</span> <span class="n">condition</span> <span class="o">==</span> <span class="s2">&quot;machined&quot;</span><span class="p">:</span>
        <span class="n">su</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">350</span><span class="p">,</span> <span class="mi">525</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1075</span><span class="p">,</span> <span class="mi">1162</span><span class="p">,</span> <span class="mi">1275</span><span class="p">,</span> <span class="mi">1450</span><span class="p">,</span> <span class="mi">1500</span><span class="p">])</span>
        <span class="n">sn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">137</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">249</span><span class="p">,</span> <span class="mi">325</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span>  <span class="mi">400</span><span class="p">,</span> <span class="mi">425</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">429</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">uts</span><span class="p">,</span> <span class="n">su</span><span class="p">,</span> <span class="n">sn</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">condition</span> <span class="o">==</span> <span class="s2">&quot;hot rolled&quot;</span><span class="p">:</span>
        <span class="n">su</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">350</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1250</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="mi">1500</span><span class="p">])</span>
        <span class="n">sn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">137</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mf">237.5</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">uts</span><span class="p">,</span> <span class="n">su</span><span class="p">,</span> <span class="n">sn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shaftendur : Surface condition not recognised&quot;</span><span class="p">)</span></div>

<span class="c1"># rel : Desired reliability (for example 0.99)</span>
<span class="c1"># Mott Table 5-2</span>


<div class="viewcode-block" id="shaftreliability"><a class="viewcode-back" href="../../api.html#melib.library.shaftreliability">[docs]</a><span class="k">def</span> <span class="nf">shaftreliability</span><span class="p">(</span><span class="n">rel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``rel`` is the desired target reliability, e.g. 0.10 for 10%</span>

<span class="sd">        The returned value is the reliability factor ``CR``</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; shaftreliability(0.99)</span>
<span class="sd">            &gt;&gt;&gt; 0.81</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rel</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;SHAFTRELIABILITY error rel=</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rel</span><span class="p">)</span>
    <span class="c1"># The reliability factor</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">]</span>
    <span class="n">CR</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]</span>
    <span class="n">cr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CR</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cr</span></div>

<span class="c1"># dia: Shaft diameter[mm]</span>


<div class="viewcode-block" id="sizefactor"><a class="viewcode-back" href="../../api.html#melib.library.sizefactor">[docs]</a><span class="k">def</span> <span class="nf">sizefactor</span><span class="p">(</span><span class="n">dia</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``dia`` is the shaft diameter in mm</span>

<span class="sd">        The returned value is the size factor ``CS`` read off a digitised</span>
<span class="sd">        version of the Mott chart Fig 5-9.</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; sizefactor(200)</span>
<span class="sd">            &gt;&gt;&gt; 0.6964150943396226</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.5</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">75.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">203.0</span><span class="p">,</span> <span class="mf">250.0</span><span class="p">])</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.94</span><span class="p">,</span> <span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.776</span><span class="p">,</span> <span class="mf">0.755</span><span class="p">,</span> <span class="mf">0.720</span><span class="p">,</span> <span class="mf">0.695</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dia</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">dia</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dia</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dia</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">dia</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">8.00</span><span class="p">:</span>
                <span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">dia</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">DA</span><span class="p">,</span> <span class="n">CS</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cs</span>
    <span class="k">if</span> <span class="n">dia</span> <span class="o">&lt;</span> <span class="mf">8.00</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.0</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">dia</span><span class="p">,</span> <span class="n">DA</span><span class="p">,</span> <span class="n">CS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cs</span></div>

<span class="c1"># Shaft functions</span>


<span class="k">def</span> <span class="nf">shoulderscfdelta</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">D</span><span class="o">/</span><span class="n">d</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">deltafit</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="mf">33.78826</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mf">428.02758</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mf">2360.48676</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>    \
        <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">7400.99264</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mf">14428.18588</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mf">17907.43776</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>   \
        <span class="o">+</span> <span class="p">(</span><span class="mf">13817.79262</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mf">6060.73737</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mf">1157.17958</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">deltafit</span>


<div class="viewcode-block" id="shoulderscf"><a class="viewcode-back" href="../../api.html#melib.library.shoulderscf">[docs]</a><span class="k">def</span> <span class="nf">shoulderscf</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">uts</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># as per AS1403</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the stress concentration factor for a shaft shoulder according to</span>
<span class="sd">        AS1403.</span>

<span class="sd">            .. image:: ../../assets/shoulderscf.png</span>


<span class="sd">        ``D, d, R`` are the dimensions as shown in the figure above.</span>

<span class="sd">        ``uts`` is the tensile strength in MPa.</span>

<span class="sd">        The returned value is the stress concentration factor as per AS1403.</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; shoulderscf(200,100,10, 450)</span>
<span class="sd">            &gt;&gt;&gt; 1.6973600000014022</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">D</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">D</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">d</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;Shoulder SCF cannot be computer because shaft diameter is zero.&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="c1">#    print(&quot;shoulderscf(%.0f,%.0f,%.1f,%.0f)&quot;%(D,d,R,uts))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">900</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.11</span><span class="p">,</span> <span class="mf">1.075</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.40</span><span class="p">,</span> <span class="mf">1.30</span><span class="p">,</span> <span class="mf">1.30</span><span class="p">,</span> <span class="mf">1.38</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.88</span><span class="p">,</span> <span class="mf">1.86</span><span class="p">,</span> <span class="mf">1.87</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">],</span>
         <span class="p">[</span><span class="mf">2.52</span><span class="p">,</span> <span class="mf">2.70</span><span class="p">,</span> <span class="mf">2.90</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">]]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">shoulderscfdelta</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">R</span><span class="o">/</span><span class="n">d</span><span class="o">+</span><span class="n">delta</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">uts</span><span class="p">,</span> <span class="n">Z</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="c1">#         CALCRECORD =&quot;$\\text{Shoulder SCF: }\\Delta=%.3f\\text{; }Z=\\frac{%.1f}{%.1f}+%.3f\\rightarrow%.3f$\</span>
        <span class="c1"># &quot;%(delta, R, d, delta, K)</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;Shoulder SCF as per AS1403 (d=</span><span class="si">%.1f</span><span class="s2"> mm, D=</span><span class="si">%.1f</span><span class="s2"> mm, r=</span><span class="si">%.2f</span><span class="s2"> mm, Shaft UTS=</span><span class="si">%.0f</span><span class="s2"> MPa): </span><span class="se">\</span>
<span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">uts</span><span class="p">)</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">Delta=</span><span class="si">%.3f</span><span class="se">\\</span><span class="s2">text{; }Z=</span><span class="se">\\</span><span class="s2">frac{</span><span class="si">%.1f</span><span class="s2">}{</span><span class="si">%.1f</span><span class="s2">}+</span><span class="si">%.3f</span><span class="se">\\</span><span class="s2">rightarrow</span><span class="si">%.3f</span><span class="s2">$</span><span class="se">\</span>
<span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">K</span></div>

<span class="c1"># AS1403</span>


<div class="viewcode-block" id="keyseatscf"><a class="viewcode-back" href="../../api.html#melib.library.keyseatscf">[docs]</a><span class="k">def</span> <span class="nf">keyseatscf</span><span class="p">(</span><span class="n">uts</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        .. image:: ../../assets/keyseatscf.png</span>

<span class="sd">        Calculates the stress concentration factor for a sidemilled keyway with</span>
<span class="sd">        a H7/k6 transition fit according to AS1403 Figure 7.  The other keyways</span>
<span class="sd">        in the AS1403 chart are not supported by this function.</span>

<span class="sd">        The returned value is the stress concentration factor as per Figure 7 of AS1403.</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; keyseatscf(650)</span>
<span class="sd">            &gt;&gt;&gt; 1.6365625047124999</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="c1"># p=[1.43518519e-08, -2.32539683e-05,   1.45429894e-02,-1.02420635e+00] # for H7/s6 interference fit</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.79629630e-09</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.88492063e-06</span><span class="p">,</span>   <span class="mf">2.90687831e-03</span><span class="p">,</span>
         <span class="mf">7.68412698e-01</span><span class="p">]</span>  <span class="c1"># for H7/k6 transition fit</span>
    <span class="n">kt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">uts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;Keyseat SCF as per AS1403 for a sidemilled key with a H7/k6 transition fit, Shaft UTS=</span><span class="si">%.0f</span><span class="s2"> MPa:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">uts</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;$</span><span class="si">%s</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">^3-</span><span class="si">%s</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">^2+</span><span class="si">%s</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">+</span><span class="si">%.4f</span><span class="s2">=</span><span class="si">%.3f</span><span class="s2">$</span><span class="se">\</span>
<span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">engfmt</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">uts</span><span class="p">,</span> <span class="n">engfmt</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">uts</span><span class="p">,</span>
            <span class="n">engfmt</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">uts</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">kt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kt</span></div>

<span class="c1"># This is for bearing fit K8/k6 (transition fit)</span>
<span class="c1"># AS1403 SCF for a bearing seat (L14/S53)</span>


<div class="viewcode-block" id="bearingscf"><a class="viewcode-back" href="../../api.html#melib.library.bearingscf">[docs]</a><span class="k">def</span> <span class="nf">bearingscf</span><span class="p">(</span><span class="n">uts</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        .. image:: ../../assets/bearingscf.png</span>

<span class="sd">        Calculates the stress concentration factor for a bearing seat with</span>
<span class="sd">        a K8/k6 transition fit according to AS1403 Figure 5.  The other bearing</span>
<span class="sd">        fit in the AS1403 chart is not supported by this function.</span>

<span class="sd">        The returned value is the stress concentration factor as per Figure 5 of AS1403.</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; bearingscf(800)</span>
<span class="sd">            &gt;&gt;&gt; 2.08896825088</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="c1"># for the bearing fit in the assignment (K8/k6)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.40740741e-09</span><span class="p">,</span>   <span class="mf">6.01587302e-06</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.05767196e-03</span><span class="p">,</span> <span class="mf">1.91753968e+00</span><span class="p">]</span>
    <span class="n">scf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">uts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;Bearing SCF : For a K8/k6 fit from AS1403, Shaft UTS=</span><span class="si">%.0f</span><span class="s2"> MPa:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">uts</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;$-</span><span class="si">%s</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">^3+</span><span class="si">%s</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">^2-</span><span class="si">%s</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">+</span><span class="si">%.4f</span><span class="s2">=</span><span class="si">%.3f</span><span class="s2">$</span><span class="se">\</span>
<span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">engfmt</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">uts</span><span class="p">,</span> <span class="n">engfmt</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">uts</span><span class="p">,</span>
            <span class="n">engfmt</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">uts</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">scf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scf</span></div>

<span class="c1"># Shrink fit for H7/s6 fit as per AS1403 Figure 6</span>


<div class="viewcode-block" id="shrinkscf"><a class="viewcode-back" href="../../api.html#melib.library.shrinkscf">[docs]</a><span class="k">def</span> <span class="nf">shrinkscf</span><span class="p">(</span><span class="n">uts</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        .. image:: ../../assets/shrinkscf.png</span>

<span class="sd">        Calculates the stress concentration factor for a component fitted onto a</span>
<span class="sd">        shaft using a H7/s6 interference fit, according to Figure 6 of AS1403.</span>
<span class="sd">        The other two fits in the AS1403 chart are not supported by this function.</span>

<span class="sd">        The returned value is the stress concentration factor as per Figure 6 of AS1403.</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; shrinkscf(400)</span>
<span class="sd">            &gt;&gt;&gt; 1.6204761921599997</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">3.61111111e-09</span><span class="p">,</span>   <span class="mf">8.27380952e-06</span><span class="p">,</span>  <span class="o">-</span>
                  <span class="mf">3.95079365e-03</span><span class="p">,</span> <span class="mf">2.10809524e+00</span><span class="p">])</span>
    <span class="n">scf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">uts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;Shrink fit SCF as per AS1403 for H7/s6 fit, Shaft UTS=</span><span class="si">%.0f</span><span class="s2"> MPa:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">uts</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;$-</span><span class="si">%s</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">^3+</span><span class="si">%s</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">^2-</span><span class="si">%s</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.0f</span><span class="s2">+</span><span class="si">%.4f</span><span class="s2">=</span><span class="si">%.3f</span><span class="s2">$</span><span class="se">\</span>
<span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">engfmt</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">uts</span><span class="p">,</span> <span class="n">engfmt</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">uts</span><span class="p">,</span>
            <span class="n">engfmt</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">uts</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">scf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scf</span></div>


<span class="k">def</span> <span class="nf">gearmountscf</span><span class="p">(</span><span class="n">gearmount</span><span class="p">,</span> <span class="n">shaftuts</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">gmount</span> <span class="o">=</span> <span class="n">gearmount</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">gmount</span> <span class="o">==</span> <span class="s2">&quot;INTEGRAL&quot;</span><span class="p">:</span>
        <span class="n">scf</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">elif</span> <span class="s2">&quot;ONESIDED KEY&quot;</span> <span class="ow">in</span> <span class="n">gmount</span><span class="p">:</span>
        <span class="n">scf</span> <span class="o">=</span> <span class="n">keyseatscf</span><span class="p">(</span><span class="n">shaftuts</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;SHRINK FIT&quot;</span> <span class="ow">in</span> <span class="n">gmount</span><span class="p">:</span>
        <span class="n">scf</span> <span class="o">=</span> <span class="n">shrinkscf</span><span class="p">(</span><span class="n">shaftuts</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scf</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">scf</span>


<div class="viewcode-block" id="scfa"><a class="viewcode-back" href="../../api.html#melib.library.scfa">[docs]</a><span class="k">def</span> <span class="nf">scfa</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the combined stree concentration factors when two or three</span>
<span class="sd">        stress raising features coincide.  The calculation is done as per</span>
<span class="sd">        AS1403 Article 8.2 (d) adapted to three features.  The combined the SCF</span>
<span class="sd">        is the sum of the largest SCF plus 0.2 times the sum of the two lesser</span>
<span class="sd">        values.  For example, if ``k2=max(k1,k2,k3)`` , then the returned value is</span>
<span class="sd">        ``k2+0.2*(k1+k3)`` .</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; scfa(2.0, 3.0, 4.0)</span>
<span class="sd">            &gt;&gt;&gt; 5.0</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">]))</span>
    <span class="n">scf</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;Combined SCF : $</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">scf</span> <span class="o">+=</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;+0.2</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">scf</span> <span class="o">+=</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;+0.2</span><span class="se">\\</span><span class="s2">times</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;$&quot;</span>
    <span class="k">return</span> <span class="n">scf</span></div>

<span class="c1"># Examples for s: H7f4, H3s9</span>
<span class="c1"># Only supports 1-digit specs (do not use H11 for example)</span>


<div class="viewcode-block" id="isofits"><a class="viewcode-back" href="../../api.html#melib.library.isofits">[docs]</a><span class="k">def</span> <span class="nf">isofits</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s2">&quot;H7f6&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look up the upper and lower limits for the hole and the shaft for the</span>
<span class="sd">        specified fit.  The only fits supported are</span>

<span class="sd">        * ``Hxfy`` with ``x`` = 1,2,...,11 and ``y`` =3,4,...,9 and 3 &lt; D &lt;= 250</span>
<span class="sd">        * ``Hxsy`` with ``x`` = 1,2,...,11 and ``y`` =3,4,...,9 and 3 &lt; D &lt;=1250</span>

<span class="sd">        The data is read from the ``fits`` sheet in the ``shaft.xlsx`` file.</span>

<span class="sd">        **Examples**</span>
<span class="sd">            &gt;&gt;&gt; isofits(d=60.0, s=&quot;H7f6&quot;)</span>
<span class="sd">            &gt;&gt;&gt; (30, 0, -30, -49)</span>
<span class="sd">            &gt;&gt;&gt; isofits(d=60.0, s=&quot;H7s6&quot;)</span>
<span class="sd">            &gt;&gt;&gt; (30, 0, 72, 53)</span>
<span class="sd">            &gt;&gt;&gt; isofits(d=110.0, s=&quot;H7s6&quot;)</span>
<span class="sd">            &gt;&gt;&gt; ((35, 0, 101, 79)</span>
<span class="sd">            &gt;&gt;&gt; isofits(d=2000.0, s=&quot;H7s6&quot;)</span>
<span class="sd">            &gt;&gt;&gt; SystemExit: isofits: nominal diameter (2000) is too large</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">HTABLEFIRSTROW</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">fTABLEFIRSTROW</span> <span class="o">=</span> <span class="mi">46</span>
    <span class="n">sTABLEFIRSTROW</span> <span class="o">=</span> <span class="mi">76</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
            <span class="s2">&quot;LIBRARY.PY - isofits error.  Unknown Hole fit spec: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;fs&quot;</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
            <span class="s2">&quot;LIBRARY.PY - isofits error.  Unknown shaft fit spec: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">X</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">opendatafiles</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;shaft&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">X</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;fits&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">X</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;fits&quot;</span><span class="p">)</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span>
                  <span class="mi">500</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">1250.001</span><span class="p">])</span>  <span class="c1"># Basic sizes for H table</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">&gt;=</span><span class="mf">1250.0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;isofits: nominal diameter (</span><span class="si">%.0f</span><span class="s2">) is too large&quot;</span><span class="o">%</span><span class="n">d</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">D</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
    <span class="c1"># print(&quot;For d=%.0d, s=&#39;%s&#39;, j=%d&quot;%(d,s,j))</span>
    <span class="n">irow</span> <span class="o">=</span> <span class="n">HTABLEFIRSTROW</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">jcol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span>
    <span class="n">hupper</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="n">jcol</span><span class="p">))</span>
    <span class="n">hlower</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">jcol</span><span class="p">))</span>
<span class="c1">#</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">&gt;=</span><span class="mf">250.0</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;isofits: nominal diameter (</span><span class="si">%.0f</span><span class="s2">) is too large&quot;</span><span class="o">%</span><span class="n">d</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">250.001</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">D</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">irow</span> <span class="o">=</span> <span class="n">fTABLEFIRSTROW</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">&gt;=</span><span class="mf">1250.0</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;isofits: nominal diameter (</span><span class="si">%.0f</span><span class="s2">) is too large&quot;</span><span class="o">%</span><span class="n">d</span><span class="p">)</span>

        <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span>
                      <span class="mi">280</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">355</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">560</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">710</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1120</span><span class="p">,</span> <span class="mf">1250.001</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">D</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">irow</span> <span class="o">=</span> <span class="n">sTABLEFIRSTROW</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">jcol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="c1">#    print(&quot;For d=%.0d, s=&#39;%s&#39;, irow=%d, jrow=%d&quot;%(d,s,irow,jcol))</span>
    <span class="n">supper</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="n">jcol</span><span class="p">))</span>
    <span class="n">slower</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">jcol</span><span class="p">))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">hupper</span><span class="p">,</span> <span class="n">hlower</span><span class="p">,</span> <span class="n">supper</span><span class="p">,</span> <span class="n">slower</span><span class="p">)</span></div>

<span class="c1"># Bending Moment Diagram</span>
<span class="c1">#   Force units [N]  (for P, Q)</span>
<span class="c1">#   Position units [m] (for p, q, c, L)</span>
<span class="c1"># Two forces (in two planes): P and Q  [N]  --- numpy arrays</span>
<span class="c1">#    P[0]=Py; Q[0]=Qy</span>
<span class="c1">#    P[1]=Pz; Q[1]=Qz</span>
<span class="c1"># Two supports: B and C</span>
<span class="c1"># The origin for positions is B, i.e. b=0</span>
<span class="c1"># Positions of other from B: p, q, c</span>
<span class="c1"># Length of the beam : L</span>
<span class="c1"># x : The positions where we want the shear force and the bending moment values</span>
<span class="c1"># The input units are always expected to be newtons and metres</span>
<span class="c1"># but the output could be in US units if &quot;metric&quot; is set to False.</span>
<span class="c1"># xpos = The array of x-positiyons where we want V and M values</span>


<div class="viewcode-block" id="bmdiagram"><a class="viewcode-back" href="../../api.html#melib.library.bmdiagram">[docs]</a><span class="k">def</span> <span class="nf">bmdiagram</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="n">cc</span><span class="o">=</span><span class="p">[],</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vlim</span><span class="o">=</span><span class="p">[],</span> <span class="n">mlim</span><span class="o">=</span><span class="p">[],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[],</span>
              <span class="n">xcrit</span><span class="o">=</span><span class="p">[],</span> <span class="n">yname</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">zname</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fu</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">xu</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function can be used to draw the shear force and the bending moment</span>
<span class="sd">        diagrams and calculate the values of the bending moments in the nominated</span>
<span class="sd">        stress points and the reaction forces for a shaft represented as a simply</span>
<span class="sd">        supported beam supported by two bearings (B and C) and subject to two</span>
<span class="sd">        loads (P and Q) as in the following diagram:</span>

<span class="sd">            .. image:: ../../assets/bmdiagram.png</span>

<span class="sd">        * ``P`` = [Py, Pz] in newtons</span>
<span class="sd">        * ``p`` = Position of the P application point from the left end, m</span>
<span class="sd">        * ``Q`` = [Qy, Qz] in newtons</span>
<span class="sd">        * ``q`` = Position of the Q application point from the left end, m</span>
<span class="sd">        * ``L`` = The distance between the two supports, m</span>

<span class="sd">        You do not need to include ``q`` and ``Q`` if there is only one force.</span>
<span class="sd">        The other arguments are:</span>

<span class="sd">        * ``draw`` : Will draw the shear force and bending moment diagrams if True</span>
<span class="sd">        * ``xcrit`` : Will calculate the bending moments at these positions</span>
<span class="sd">        * ``filename`` : Will store the diagrams in the image file &quot;filename&quot;.png</span>


<span class="sd">        **Examples**</span>
<span class="sd">            &gt;&gt;&gt; P = np.array([-11280, 31000.0])</span>
<span class="sd">            &gt;&gt;&gt; Q = np.array([2860.0,   7860])</span>
<span class="sd">            &gt;&gt;&gt; p = 0.185</span>
<span class="sd">            &gt;&gt;&gt; q = 0.473</span>
<span class="sd">            &gt;&gt;&gt; L = 0.650</span>
<span class="sd">            &gt;&gt;&gt; xcrit = np.array([p, q])</span>
<span class="sd">            &gt;&gt;&gt; filename=&#39;examplebmdiagram&#39;</span>
<span class="sd">            &gt;&gt;&gt; (M, B, C) = bmdiagram(P, p, L, Q, q, draw=True,xcrit=xcrit, filename=filename, record=True)</span>

<span class="sd">        The above will create the following two image files:</span>

<span class="sd">            .. image:: ../../assets/examplebmdiagram_xy.png</span>

<span class="sd">            .. image:: ../../assets/examplebmdiagram_xz.png</span>

<span class="sd">        and will return</span>

<span class="sd">            M = ``array`` ([[ 1348.8,   199.9], [-4498.7, -2574.1]])</span>

<span class="sd">            B = ``array`` ([  7290.7, -24317.3])</span>

<span class="sd">            C = ``array`` ([  1129.3, -14542.7])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">P</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;bmdiagram():</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;Call this function as `bmdiagram`(P, p, L, Q, q, draw=(True or False), xcrit=[x$_1$, x$_2$, ...], filename=&quot;yourchoice&quot;)</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* P = [Py, Pz] in newtons</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* p = Position of the P application point from the left end, m</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* Q = [Qy, Qz] in newtons</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* q = Position of the Q application point from the left end, m</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* L = The distance between the two supports, m</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;You do not need to include `q` and `Q` if there is only one force.  The </span><span class="se">\</span>
<span class="s1">other arguments are:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* draw : Will draw the shear force and bending moment diagrams if True</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* xcrit : Will calculate the bending moments at these positions</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="s1">&#39;* filename : Will store the diagrams in the image file &quot;filename&quot;.png</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;(p,L,q,cc)&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cc</span><span class="p">)</span>
    <span class="n">oneplane</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">oneplane</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">cc</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">L</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cc</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">force_unit</span> <span class="o">=</span> <span class="n">fu</span>
    <span class="n">moment_unit</span> <span class="o">=</span> <span class="n">fu</span><span class="o">+</span><span class="n">xu</span>
    <span class="n">x_unit</span> <span class="o">=</span> <span class="n">xu</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># y- and-z forces on support B</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># y- and-z forces on support C</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cc</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">scc</span> <span class="o">=</span> <span class="s2">&quot;[]&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scc</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cc</span>
        <span class="n">CALCRECORD</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">BMDIAGRAM(P=[</span><span class="si">%.0f</span><span class="s2">,</span><span class="si">%.0f</span><span class="s2">],p=</span><span class="si">%.3f</span><span class="s2">,L=</span><span class="si">%.3f</span><span class="s2">,Q=[</span><span class="si">%.0f</span><span class="s2">,</span><span class="si">%.0f</span><span class="s2">],q=</span><span class="si">%.3f</span><span class="s2">,cc=</span><span class="si">%s</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span>\
            <span class="o">%</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">scc</span><span class="p">)</span>
    <span class="n">xpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xpos =&quot;</span><span class="p">,</span> <span class="n">xpos</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">xcrit array: &quot;</span>
    <span class="k">if</span> <span class="n">xcrit</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">xcrit</span> <span class="o">=</span> <span class="n">xpos</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;xcrit unspecified.  Calculate for &quot;</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcrit</span><span class="p">)):</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">, &quot;</span> <span class="o">%</span> <span class="n">xcrit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot; m </span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="n">Mcrit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xcrit</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xcrit</span><span class="p">))])</span>
    <span class="c1"># This sorting is neccesary because the force is sometimes</span>
    <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xpos</span><span class="p">)</span>
    <span class="c1"># outside the bearing span (e.g. the belt force in hdmixer)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">xpos</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x=&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xpos</span><span class="p">)])</span>
    <span class="c1"># print(&quot;(P, p)=([%.0f,%.0f], %.3f);(Q,q)=([%.0f,%.0f],%.3f); b=%.3f; c=%.3f&quot;\</span>
    <span class="c1">#    %(P[0],P[1],p,Q[0],Q[1],q,b,c))</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>  <span class="c1"># k:(0,1) --&gt; (y, z)</span>
        <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
        <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Right(R) and Left(L) Bearing forces on </span><span class="si">%s</span><span class="s2"> plane:</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;x-y&quot;</span><span class="p">,</span> <span class="s2">&quot;x-z&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
            <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot;R</span><span class="si">%s</span><span class="s2">=$-</span><span class="se">\\</span><span class="s2">frac{(p-b)P_</span><span class="si">%s</span><span class="s2">+(q-b)Q_</span><span class="si">%s</span><span class="s2">}{c-b}=</span><span class="se">\</span>
<span class="s2">-</span><span class="se">\\</span><span class="s2">frac{(</span><span class="si">%.0f</span><span class="s2">-</span><span class="si">%.0f</span><span class="s2">)(</span><span class="si">%.0f</span><span class="s2">)+(</span><span class="si">%.0f</span><span class="s2">-</span><span class="si">%.0f</span><span class="s2">)(</span><span class="si">%.0f</span><span class="s2">)}{</span><span class="si">%.0f</span><span class="s2">-</span><span class="si">%.0f</span><span class="s2">}=</span><span class="si">%.0f</span><span class="s2">$</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">fstr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">xu</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
                <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="n">sr</span> <span class="o">%</span> <span class="p">(</span><span class="n">fstr</span><span class="p">,</span> <span class="n">fstr</span><span class="p">,</span> <span class="n">fstr</span><span class="p">,</span> <span class="n">p</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
                                    <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">q</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">c</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="n">sr</span> <span class="o">%</span> <span class="p">(</span><span class="n">fstr</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;L</span><span class="si">%s</span><span class="s2">=$-P_</span><span class="si">%s</span><span class="s2">-Q_</span><span class="si">%s</span><span class="s2">-R_</span><span class="si">%s</span><span class="s2">=-(</span><span class="si">%.0f</span><span class="s2">)-(</span><span class="si">%.0f</span><span class="s2">)-(</span><span class="si">%.0f</span><span class="s2">)=</span><span class="si">%.0f</span><span class="s2">$</span><span class="se">\</span>
<span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fstr</span><span class="p">,</span> <span class="n">fstr</span><span class="p">,</span> <span class="n">fstr</span><span class="p">,</span> <span class="n">fstr</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">ix</span><span class="p">]</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">xv</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span>  <span class="n">fv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">fv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">fv</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">xm</span> <span class="o">=</span> <span class="p">[</span><span class="n">xv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>     <span class="n">xv</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">xv</span><span class="p">[</span><span class="mi">6</span><span class="p">]]</span>  <span class="c1"># Positions for moment plot</span>
        <span class="n">mm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Moment values</span>
        <span class="n">mm1</span> <span class="o">=</span> <span class="n">fv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">xm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mm2</span> <span class="o">=</span> <span class="n">mm1</span><span class="o">+</span><span class="n">fv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">xm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">xm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">mm3</span> <span class="o">=</span> <span class="n">mm2</span><span class="o">+</span><span class="n">fv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">xm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">xm</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">mm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">mm1</span><span class="p">,</span> <span class="n">mm2</span><span class="p">,</span> <span class="n">mm3</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcrit</span><span class="p">)):</span>
            <span class="n">Mcrit</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xcrit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xm</span><span class="p">,</span> <span class="n">mm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">fv</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">fv</span><span class="p">))</span><span class="o">/</span><span class="mi">30</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">fv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">dy</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">fv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dy</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">fv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">dy</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;V, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">force_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;x-</span><span class="si">%s</span><span class="s2"> plane&quot;</span> <span class="o">%</span> <span class="p">([</span><span class="n">yname</span><span class="p">,</span> <span class="n">zname</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vlim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">vlim</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vlim</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Position, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;BM, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">moment_unit</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mlim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">mlim</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mlim</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># Calculate the Mxy and Mxz at the critical points:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcrit</span><span class="p">)):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xcrit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Mcrit</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1">#</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_x</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">[</span><span class="n">yname</span><span class="p">,</span> <span class="n">zname</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">* Stress point locations [mm] = &quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">* Stress point locations [m] = &quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcrit</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%6.0f</span><span class="s2">, &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xcrit</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">, &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">xcrit</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">* BMZ (x-y plane) [N-m] = &quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcrit</span><span class="p">)):</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%6.0f</span><span class="s2">,&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Mcrit</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="c1">#    CALCRECORD=CALCRECORD[:-1]+&quot; %s\n&quot;%(fu+xu)</span>
        <span class="c1">#</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">* BMY (x-z plane) [N-m] = &quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcrit</span><span class="p">)):</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%6.0f</span><span class="s2">,&quot;</span> <span class="o">%</span> <span class="n">Mcrit</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="c1">#    CALCRECORD=CALCRECORD[:-1]+&quot; %s\n&quot;%(fu+xu)</span>
    <span class="k">if</span> <span class="n">oneplane</span><span class="p">:</span>
        <span class="n">Mcrit</span> <span class="o">=</span> <span class="n">Mcrit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Mcrit</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span></div>


<span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">11280</span><span class="p">,</span> <span class="mf">31000.0</span><span class="p">])</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2860.0</span><span class="p">,</span>   <span class="mi">7860</span><span class="p">])</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mf">0.185</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mf">0.473</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">0.650</span>
    <span class="n">xcrit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
<span class="c1">#    filename=&#39;examplebmdiagram&#39;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span> <span class="o">=</span> <span class="n">bmdiagram</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">xcrit</span><span class="o">=</span><span class="n">xcrit</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Bearing functions:</span>
<span class="c1"># ARGUMENTS:</span>
<span class="c1"># F = np.array([LB, RB]) with LB/RB as left/right bearing total radial force(kN)</span>
<span class="c1"># ncycles = Bearing design life desired at F (cycles)</span>
<span class="c1"># xb = Xcel pointer to the bearing data file</span>
<span class="c1"># cr = Reliability factor; default=1 (L10 or 90% reliability)</span>
<span class="c1"># dmin = np.array([LDmin,RDmin]) The minimum bore diameter, mm , for left and right</span>


<div class="viewcode-block" id="bearingpick"><a class="viewcode-back" href="../../api.html#melib.library.bearingpick">[docs]</a><span class="k">def</span> <span class="nf">bearingpick</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">ncycles</span><span class="p">,</span> <span class="n">xb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cr</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function selects suitable deep groove ball bearings for a shaft</span>
<span class="sd">        supported by two bearings.  It picks the first bearing that satisfies</span>
<span class="sd">        the requirements in the ``metric`` sheet of the bearing data file, ``bearing.xlsx``</span>

<span class="sd">        The function returns a ``dictionary`` variable with the fields as defined</span>
<span class="sd">        in the examples below.</span>

<span class="sd">        The arguments to the function are:</span>

<span class="sd">            ``F`` [kN] : The radial load(s). Could be one single force or</span>
<span class="sd">            a numpy array ``[FL, FR]`` where ``FL`` and ``FR`` are the total</span>
<span class="sd">            radial forces on the left and right bearings</span>

<span class="sd">            ``ncycles`` : Required life as number of cycles</span>

<span class="sd">            *** Optional Arguments *** :</span>

<span class="sd">            ``xb`` : Pointer to the bearing data Excel file</span>
<span class="sd">            (if a different file with the same format but different data is to be used)</span>

<span class="sd">            ``cr`` : Reliability factor. The default is 1, corresponding to an</span>
<span class="sd">            L10 life or 90% reliability</span>

<span class="sd">            ``dmin`` [mm]  Minimum bore diameters, reflecting the strength</span>
<span class="sd">            requirement that the shaft segment diameters on the left and right</span>
<span class="sd">            support points cannot be less than these specified values.  The minimum</span>
<span class="sd">            of the two dmin values are used.  The argument can be a single number or</span>
<span class="sd">            a numpy array.  The default value is 0  indicating no diameter requirement.</span>

<span class="sd">        **Examples**</span>
<span class="sd">            &gt;&gt;&gt; bearingpick(120, 2.e6)</span>
<span class="sd">            &gt;&gt;&gt; {&#39;no&#39;: 6319,        # Bearing number</span>
<span class="sd">                 &#39;bore&#39;: 95,        # Bore diameter, mm</span>
<span class="sd">                 &#39;C&#39;: 153,          # Dynamic rating, kN</span>
<span class="sd">                 &#39;rmax&#39;: 2.5,       # Maximum fillet radius</span>
<span class="sd">                 &#39;dmin&#39;: 108,       # Minimum shaft shoulder diameter, mm</span>
<span class="sd">                 &#39;dmax&#39;: 187,       # Maximum shaft shoulder diameter, mm</span>
<span class="sd">                 &#39;mass&#39;: 5.65,      # Bearing mass, kg</span>
<span class="sd">                 &#39;width&#39;: 45,       # Bearing width, mm</span>
<span class="sd">                 &#39;req&#39;: 151.2,      # Required rating (calculated using F and ncycles )</span>
<span class="sd">                 &#39;constraint&#39;:&#39;Load&#39; # Would be &#39;Dmin&#39; if the choice were based on diameter</span>
<span class="sd">                 &#39;Co&#39;: 118          # Static rating</span>

<span class="sd">            &gt;&gt;&gt; bearingpick(120, 2.e6, dmin=105</span>
<span class="sd">            &gt;&gt;&gt; {&#39;no&#39;: 6226,</span>
<span class="sd">                 &#39;bore&#39;: 130,</span>
<span class="sd">                 &#39;C&#39;: 156,</span>
<span class="sd">                 &#39;rmax&#39;: 2.5,</span>
<span class="sd">                 &#39;dmin&#39;: 143,</span>
<span class="sd">                 &#39;dmax&#39;: 217,</span>
<span class="sd">                 &#39;mass&#39;: 5.8,</span>
<span class="sd">                 &#39;width&#39;: 40,</span>
<span class="sd">                 &#39;req&#39;: 151.19052598738477,</span>
<span class="sd">                 &#39;constraint&#39;: &#39;Dmin&#39;,</span>
<span class="sd">                 &#39;Co&#39;: 132}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">CALCRECORD</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">F</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="c1"># if xb == None:</span>
    <span class="c1">#     xb = Xcel(&quot;data\\bearing.xlsx&quot;, sheetname=&quot;metric&quot;)</span>
    <span class="c1"># else:</span>
    <span class="c1">#     xb.sheet(&quot;metric&quot;)</span>
    <span class="k">if</span> <span class="n">xb</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="n">opendatafiles</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bearing&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xb</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;metric&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xb</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;metric&quot;</span><span class="p">)</span>
    <span class="n">Pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">F</span><span class="p">))</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">Pd</span><span class="o">*</span><span class="p">(</span><span class="n">ncycles</span><span class="o">/</span><span class="p">(</span><span class="n">cr</span><span class="o">*</span><span class="mf">1.e6</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;bearingpick([</span><span class="si">%.1f</span><span class="s2">,</span><span class="si">%.1f</span><span class="s2">] kN, </span><span class="si">%.0f</span><span class="s2"> cycles, dmin=</span><span class="si">%.0f</span><span class="s2"> mm)==&gt; C=</span><span class="si">%.2f</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ncycles</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">constraint</span> <span class="o">=</span> <span class="s2">&quot;Load&quot;</span>
    <span class="k">for</span> <span class="n">irow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">xb</span><span class="o">.</span><span class="n">maxrow</span><span class="p">()):</span>
        <span class="n">rating</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">bore</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%03d</span><span class="s2">. C=</span><span class="si">%.0f</span><span class="s2">, D=</span><span class="si">%.0f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="n">rating</span><span class="p">,</span> <span class="n">bore</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rating</span> <span class="o">&gt;=</span> <span class="n">C</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bore</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">constraint</span> <span class="o">=</span> <span class="s2">&quot;Dmin&quot;</span>
                <span class="k">continue</span>
            <span class="n">bearingnumber</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">bore</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="n">Co</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="c1">#            C=xb.cell(irow,8)</span>
            <span class="n">rmax</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">irow</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
            <span class="n">bearing</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;no&quot;</span><span class="p">:</span> <span class="n">bearingnumber</span><span class="p">,</span> <span class="s2">&quot;bore&quot;</span><span class="p">:</span> <span class="n">bore</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="n">rating</span><span class="p">,</span> <span class="s2">&quot;rmax&quot;</span><span class="p">:</span> <span class="n">rmax</span><span class="p">,</span>
                       <span class="s2">&quot;dmin&quot;</span><span class="p">:</span> <span class="n">dmin</span><span class="p">,</span> <span class="s2">&quot;dmax&quot;</span><span class="p">:</span> <span class="n">dmax</span><span class="p">,</span> <span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="n">mass</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
                       <span class="s2">&quot;req&quot;</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;constraint&#39;</span><span class="p">:</span> <span class="n">constraint</span><span class="p">,</span> <span class="s1">&#39;Co&#39;</span><span class="p">:</span> <span class="n">Co</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">bearing</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CALCRECORD</span> <span class="o">+=</span> <span class="s2">&quot;-- skip</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;no&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;bore&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;rmax&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;dmin&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;dmax&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">rating</span><span class="p">}</span></div>


<span class="k">def</span> <span class="nf">bearingdims</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">bnum</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">xb</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="n">Xcel</span><span class="p">(</span><span class="s2">&quot;bearing.xlsx&quot;</span><span class="p">,</span> <span class="n">sheetname</span><span class="o">=</span><span class="s2">&quot;metric&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xb</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;metric&quot;</span><span class="p">)</span>

    <span class="n">dims</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bore&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;dmin&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;dmax&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;rmax&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
            <span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>
    <span class="n">xb</span><span class="o">.</span><span class="n">sheet</span><span class="p">(</span><span class="s2">&quot;metric&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xb</span><span class="o">.</span><span class="n">vir</span><span class="p">(</span><span class="n">bnum</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

<span class="c1"># r: Desired reliabilityy, e.g. 0.99 for 99%</span>
<span class="c1"># RETURN:</span>
<span class="c1"># KR: Reliability factor</span>


<div class="viewcode-block" id="bearingrel"><a class="viewcode-back" href="../../api.html#melib.library.bearingrel">[docs]</a><span class="k">def</span> <span class="nf">bearingrel</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The bearing reliability factor corresponding to the desired reliability</span>

<span class="sd">        ``r`` is the desired reliability, e.g. 0.90 for an L10 life.</span>

<span class="sd">        **Examples**</span>
<span class="sd">            &gt;&gt;&gt; bearingrel(0.99)</span>
<span class="sd">            &gt;&gt;&gt; 0.21</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">/</span><span class="mi">100</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">]</span>
    <span class="n">Kr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Kr</span></div>


<div class="viewcode-block" id="dgbbrtfacs"><a class="viewcode-back" href="../../api.html#melib.library.dgbbrtfacs">[docs]</a><span class="k">def</span> <span class="nf">dgbbrtfacs</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">TC</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is used in selection of a bearing subject to both radial</span>
<span class="sd">        and thrust loads.  As you will see in the lectures, this is an iterative</span>
<span class="sd">        process and this function can be called repeatedly in search of a solution.</span>

<span class="sd">        The function always returns a tuple with three components (e, TC, Y), one the same as</span>
<span class="sd">        the supplied value and the other two computed by the function.</span>
<span class="sd">        There are three arguments and only one should be specified.</span>

<span class="sd">        ``e`` is specified.  The function computes the values of T/Co and Y from the</span>
<span class="sd">        bearing thrust factors table (e.g. Mott Table 14-5)</span>

<span class="sd">        ``TC`` (representing T/Co) is specified.  The function computes e and Y</span>

<span class="sd">        ``Y`` is specified.  The function computes T/Co and e</span>

<span class="sd">        **Examples**</span>
<span class="sd">            &gt;&gt;&gt; dgbbrtfacs(e=0.27)</span>
<span class="sd">            &gt;&gt;&gt; (0.27, 0.07, 1.63)</span>
<span class="sd">            &gt;&gt;&gt; dgbbrtfacs(TC=0.027)</span>
<span class="sd">            &gt;&gt;&gt; (0.218, 0.027, 2.01)</span>
<span class="sd">            &gt;&gt;&gt; dgbbrtfacs(Y=1.15)</span>
<span class="sd">            &gt;&gt;&gt; (0.38, 0.28, 1.15)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">])</span>
    <span class="n">TCa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">14</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">560</span><span class="p">])</span><span class="o">/</span><span class="mi">1000</span>
    <span class="n">Ya</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.30</span><span class="p">,</span> <span class="mf">1.99</span><span class="p">,</span> <span class="mf">1.71</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">,</span> <span class="mf">1.31</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">,</span> <span class="mf">1.04</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ea</span> <span class="o">==</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">TC</span> <span class="o">=</span> <span class="n">TCa</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">Ya</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">TC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ea</span><span class="p">,</span> <span class="n">TCa</span><span class="p">)</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ea</span><span class="p">,</span> <span class="n">Ya</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">TC</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">TCa</span> <span class="o">==</span> <span class="n">TC</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">ea</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">Ya</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">TC</span><span class="p">,</span> <span class="n">TCa</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">TC</span><span class="p">,</span> <span class="n">TCa</span><span class="p">,</span> <span class="n">Ya</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">Y</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Ya</span> <span class="o">==</span> <span class="n">Y</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">TC</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">ea</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">TCa</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Ya</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span>
            <span class="n">TC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Ya</span><span class="p">,</span> <span class="n">TCa</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">TC</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span></div>

<span class="c1"># metric key sizes</span>
<span class="c1"># d = Shaft diameter in mm</span>
<span class="c1"># Returns W and H of the parallel key for this shaft diameter</span>
<span class="c1"># Data from Mott Table 11-1, which is DIN6885, T1 data (I checked it against</span>
<span class="c1"># Roloff/Matek, Tabellenbuch, TB12-2)</span>


<div class="viewcode-block" id="keysize"><a class="viewcode-back" href="../../api.html#melib.library.keysize">[docs]</a><span class="k">def</span> <span class="nf">keysize</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a tuple (width,height) for the specified diameter, d[mm] as per</span>
<span class="sd">        DIN6885, T1 (and also Table 11-1 in Mott).</span>

<span class="sd">        **Examples**</span>

<span class="sd">        &gt;&gt;&gt; keysize(20)</span>
<span class="sd">        &gt;&gt;&gt; (6, 6)</span>
<span class="sd">        &gt;&gt;&gt; keysize(120)</span>
<span class="sd">        &gt;&gt;&gt; (32, 18)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span>
                  <span class="mi">110</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">380</span><span class="p">,</span> <span class="mi">440</span><span class="p">,</span> <span class="mi">500</span><span class="p">])</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span>
                  <span class="mi">63</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
                  <span class="mi">36</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">D</span> <span class="o">&gt;=</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">H</span><span class="p">[</span><span class="n">j</span><span class="p">])</span></div>

<span class="c1"># ARGUMENTS</span>
<span class="c1"># m - Gear module, mm</span>
<span class="c1"># Np - Pinion toth number  (on the intermediate shaft)</span>
<span class="c1"># Ng - Gear tooth number (on the load shaft)</span>
<span class="c1"># Ni - Idler (the idler is between the pinion and the gear) tooth number</span>
<span class="c1"># s - The distance between pinion and gear centers, mm</span>
<span class="c1"># beta - The angle PINION-IDLER centre line makes with the vertical, degrees</span>
<span class="c1"># NA - Number of teeth on the input gear on the input (motor) shaft</span>
<span class="c1"># NB - Number of teeth on the gear on the intermediate shaft (NA drives NB)</span>


<span class="k">def</span> <span class="nf">plotidler</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Np</span><span class="p">,</span> <span class="n">Ng</span><span class="p">,</span> <span class="n">Ni</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span> <span class="n">NB</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">Rp</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">Np</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">Rg</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">Ng</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">Ri</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">Ni</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">Np</span><span class="o">+</span><span class="n">Ni</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>  <span class="c1"># Centre distance for Gear C and the Idler</span>
    <span class="n">di</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">Ng</span><span class="o">+</span><span class="n">Ni</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>  <span class="c1"># Centre distance for Gear D and the Idler</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rp</span><span class="o">+</span><span class="n">Ri</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">PIE</span><span class="p">)</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rp</span><span class="o">+</span><span class="n">Ri</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">PIE</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">ci</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">PIE</span><span class="p">),</span> <span class="n">ci</span><span class="o">*</span><span class="n">ci</span><span class="o">-</span><span class="n">di</span><span class="o">*</span><span class="n">di</span><span class="p">]))</span>

    <span class="n">pinion</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gear</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">Rg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">idler</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="o">-</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gearB</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">m</span><span class="o">*</span><span class="n">NB</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gearA</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">NA</span><span class="o">+</span><span class="n">NB</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">m</span><span class="o">*</span><span class="n">NA</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
                       <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>  <span class="c1"># clear things for fresh plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">NA</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">NB</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Rg</span><span class="o">+</span><span class="n">s</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="n">xi</span><span class="o">-</span><span class="n">Ri</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">NB</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Rp</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">pinion</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">gear</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">idler</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">gearB</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">gearA</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="n">Rp</span><span class="p">,</span> <span class="n">s</span><span class="o">+</span><span class="n">Rg</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">Rp</span><span class="p">],</span>  <span class="s1">&#39;k-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="n">Rp</span><span class="p">,</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">Rp</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;k-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">xi</span><span class="o">-</span><span class="n">Ri</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">Rp</span><span class="p">,</span> <span class="o">-</span><span class="n">xi</span><span class="o">+</span><span class="n">Ri</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">Rp</span><span class="p">],</span> <span class="p">[</span><span class="n">yi</span><span class="p">,</span> <span class="n">yi</span><span class="p">],</span> <span class="s1">&#39;b-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">xi</span><span class="p">,</span> <span class="o">-</span><span class="n">xi</span><span class="p">],</span> <span class="p">[</span><span class="n">yi</span><span class="o">-</span><span class="n">Ri</span><span class="o">-</span><span class="n">dr</span><span class="p">,</span> <span class="n">yi</span><span class="o">+</span><span class="n">Ri</span><span class="o">+</span><span class="n">dr</span><span class="p">],</span> <span class="s1">&#39;b-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">Rg</span><span class="o">-</span><span class="n">dr</span><span class="p">,</span> <span class="n">Rg</span><span class="o">+</span><span class="n">dr</span><span class="p">],</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span> <span class="s1">&#39;k-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
    <span class="c1"># plt.plot([0, -xi],[0, yi], color=&#39;r&#39;)</span>
    <span class="c1">#plt.text(-xi, yi, &quot;(%.1f, %.1f)&quot;%(-xi, Rp+yi))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span>
    <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">),</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">s</span><span class="o">+</span><span class="n">dy</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Np=</span><span class="si">%d</span><span class="s2">, Ng=</span><span class="si">%d</span><span class="s2">, Ni=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="n">Ng</span><span class="p">,</span> <span class="n">Ni</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1">#    plt.show()</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># plotidler(5,17,54,29,30, 17,53)  # Data for the 2020 example file (0.xlsx)</span>
<span class="c1">#</span>

<span class="c1"># Miscellaneous</span>
<span class="c1">#</span>
<span class="c1"># STRESS CONCENTRATION FACTORS:</span>
<span class="c1"># The following is for the same geometry as that in shoulderscf(D, d, R, uts)</span>
<span class="c1"># However, this one is for an axial load it is also not adjusted for the UTS</span>
<span class="c1"># as in the AS1403 chart</span>


<div class="viewcode-block" id="scf_roundbartension"><a class="viewcode-back" href="../../api.html#melib.library.scf_roundbartension">[docs]</a><span class="k">def</span> <span class="nf">scf_roundbartension</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># used to be scf_shaft_with_shoulder</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The stress concentration factor for a stepped round bar in tension</span>

<span class="sd">        .. image:: ../../assets/scf_roundbartension.png</span>

<span class="sd">        ``D, d, r`` are the dimensions as in the figure above in mm.</span>

<span class="sd">        **Example**</span>
<span class="sd">            &gt;&gt;&gt; scf_roundbartension(200, 100, 10)</span>
<span class="sd">            &gt;&gt;&gt; 1.964</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">D</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="s2">&quot;scf_roundbartension(D, d, r) $</span><span class="se">\\</span><span class="s2">rightarrow$ SCF</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="o">/</span><span class="n">r</span>
    <span class="n">yq</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mf">0.1</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mf">2.0</span><span class="p">:</span>
        <span class="n">C1</span> <span class="o">=</span> <span class="mf">0.926</span><span class="o">+</span><span class="mf">1.157</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.099</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C2</span> <span class="o">=</span> <span class="mf">0.012</span><span class="o">-</span><span class="mf">3.036</span><span class="o">*</span><span class="n">yq</span><span class="o">+</span><span class="mf">0.961</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C3</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.302</span><span class="o">+</span><span class="mf">3.977</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">1.744</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C4</span> <span class="o">=</span> <span class="mf">0.365</span><span class="o">-</span><span class="mf">2.098</span><span class="o">*</span><span class="n">yq</span><span class="o">+</span><span class="mf">0.878</span><span class="o">*</span><span class="n">y</span>
    <span class="k">elif</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mf">2.0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mf">20.0</span><span class="p">:</span>
        <span class="n">C1</span> <span class="o">=</span> <span class="mf">1.200</span><span class="o">+</span><span class="mf">0.860</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.022</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.805</span><span class="o">-</span><span class="mf">0.346</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.038</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C3</span> <span class="o">=</span> <span class="mf">2.198</span><span class="o">-</span><span class="mf">0.486</span><span class="o">*</span><span class="n">yq</span><span class="o">+</span><span class="mf">0.165</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C4</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.593</span><span class="o">-</span><span class="mf">0.028</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.106</span><span class="o">*</span><span class="n">y</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">C4</span><span class="p">,</span> <span class="n">C3</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">C1</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">D</span>
    <span class="n">Kt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Kt</span></div>


<span class="c1"># Stepped shaft subject to torsion (Peterson Chart 3.12)</span>
<span class="n">Peterson_3_12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.905</span><span class="p">,</span> <span class="mf">0.783</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.075</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.437</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.969</span><span class="p">,</span> <span class="mf">0.553</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">1.557</span><span class="p">,</span> <span class="mf">1.073</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.578</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.061</span><span class="p">,</span> <span class="mf">0.171</span><span class="p">,</span> <span class="mf">0.086</span><span class="p">]])</span>

<span class="c1"># The following function is based on the coefficients in Paterson Stress Charts</span>
<span class="c1"># Chart 3.10, p 165</span>


<span class="k">def</span> <span class="nf">scf_roundbarbending</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># used to be scf_roundbar_bending(d,D,R)</span>
    <span class="k">if</span> <span class="n">D</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="s2">&quot;scf_roundbarbending(D, d, r) $</span><span class="se">\\</span><span class="s2">rightarrow$ SCF</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="o">/</span><span class="n">r</span>
    <span class="n">yq</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mf">0.1</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mf">2.0</span><span class="p">:</span>
        <span class="n">C1</span> <span class="o">=</span> <span class="mf">0.947</span><span class="o">+</span><span class="mf">1.206</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.131</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C2</span> <span class="o">=</span> <span class="mf">0.022</span><span class="o">-</span><span class="mf">3.405</span><span class="o">*</span><span class="n">yq</span><span class="o">+</span><span class="mf">0.915</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C3</span> <span class="o">=</span> <span class="mf">0.869</span><span class="o">+</span><span class="mf">1.777</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.555</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C4</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.810</span><span class="o">+</span><span class="mf">0.422</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.260</span><span class="o">*</span><span class="n">y</span>
    <span class="k">elif</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mf">2.0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mf">20.0</span><span class="p">:</span>
        <span class="n">C1</span> <span class="o">=</span> <span class="mf">1.232</span><span class="o">+</span><span class="mf">0.832</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.008</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.813</span><span class="o">+</span><span class="mf">0.968</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.260</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C3</span> <span class="o">=</span> <span class="mf">7.423</span><span class="o">-</span><span class="mf">4.868</span><span class="o">*</span><span class="n">yq</span><span class="o">+</span><span class="mf">0.869</span><span class="o">*</span><span class="n">y</span>
        <span class="n">C4</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.839</span><span class="o">+</span><span class="mf">3.070</span><span class="o">*</span><span class="n">yq</span><span class="o">-</span><span class="mf">0.600</span><span class="o">*</span><span class="n">y</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">C4</span><span class="p">,</span> <span class="n">C3</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">C1</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">D</span>
    <span class="n">Kt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Kt</span>


<span class="c1"># Mohr Circle</span>
<div class="viewcode-block" id="mohrcircle"><a class="viewcode-back" href="../../api.html#melib.library.mohrcircle">[docs]</a><span class="k">def</span> <span class="nf">mohrcircle</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">txy</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">figno</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;2d Mohr&#39;s Circle&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For the 2d stress element:</span>
<span class="sd">            .. image:: ../../assets/stresselement.png</span>

<span class="sd">        This function returns the two principal stresses and the maximum shear</span>
<span class="sd">        stress as (s1, s2, taumax) in MPa.</span>

<span class="sd">        The arguments ``sx, sy, txy`` are as in the figure.</span>

<span class="sd">        If a filename is provided, the Mohr&#39;s circle is drawn into that file.</span>

<span class="sd">        Otherwise, it is drawn on the screen.</span>

<span class="sd">        The ``figno`` and ``title`` are optional.</span>

<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; mohrcircle(10,-4,5,filename=&quot;mohrcircle.png&quot;, title=&quot;melib example&quot;)</span>
<span class="sd">        &gt;&gt;&gt; (11.60, -5.602, 8.602)</span>

<span class="sd">        .. image:: ../../assets/mohrcircle.png</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;Call as mohrcircle(sx=$</span><span class="se">\\</span><span class="s2">sigma_x$, sy=$</span><span class="se">\\</span><span class="s2">sigma_y$, txy=$</span><span class="se">\\</span><span class="s2">tau_</span><span class="si">{xy}</span><span class="s2">$,</span><span class="se">\</span>
<span class="s2">filename=&#39;yourchoice.png&#39;, title=&#39;your choice&#39;)&quot;</span>
        <span class="k">return</span> <span class="n">z</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">sx</span><span class="o">-</span><span class="n">sy</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">txy</span><span class="o">*</span><span class="n">txy</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sx</span><span class="o">+</span><span class="n">sy</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">R</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sx</span><span class="o">+</span><span class="n">sy</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">R</span>
    <span class="n">draw_circle</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">)</span>
    <span class="c1"># Plot axes</span>
    <span class="n">ascale</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">s2</span><span class="o">-</span><span class="n">R</span><span class="o">/</span><span class="n">ascale</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">s1</span><span class="o">+</span><span class="n">R</span><span class="o">/</span><span class="n">ascale</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="n">ascale</span><span class="o">*</span><span class="n">R</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">ascale</span><span class="o">*</span><span class="n">R</span>
    <span class="n">amin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">)</span>
    <span class="n">amax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span>
    <span class="n">textstart</span> <span class="o">=</span> <span class="n">amin</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="mi">100</span>
    <span class="k">if</span> <span class="n">draw_circle</span><span class="p">:</span>
        <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="o">=</span> <span class="n">openplot</span><span class="p">(</span><span class="n">figno</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">mohr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(((</span><span class="n">s1</span><span class="o">+</span><span class="n">s2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">R</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                          <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>  <span class="c1"># clear things for fresh plot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">amin</span><span class="p">,</span> <span class="n">amax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">amin</span><span class="p">,</span> <span class="n">amax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">amin</span><span class="p">,</span> <span class="n">amax</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># x axis</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">amin</span><span class="p">,</span> <span class="n">amax</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># y axis</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span>        <span class="n">txy</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sy</span><span class="p">,</span>       <span class="o">-</span><span class="n">txy</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([(</span><span class="n">s1</span><span class="o">+</span><span class="n">s2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">sx</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">txy</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Radius of the circlem</span>
        <span class="n">ox</span> <span class="o">=</span> <span class="p">(</span><span class="n">s1</span><span class="o">+</span><span class="n">s2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ox</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">mohr</span><span class="p">)</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">s1</span><span class="p">)</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">s2</span><span class="o">-</span><span class="n">dx</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">s2</span><span class="p">)</span>
        <span class="n">seff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">s1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">s2</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">s1</span><span class="o">-</span><span class="n">s2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">textstart</span><span class="p">,</span> <span class="n">amax</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;R=</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">R</span><span class="p">)</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">textstart</span><span class="p">,</span> <span class="n">amax</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span>
                               <span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">sqrt{{</span><span class="se">\\</span><span class="s1">sigma_1^2+</span><span class="se">\\</span><span class="s1">sigma_1^2-(</span><span class="se">\\</span><span class="s1">sigma_1^2-</span><span class="se">\\</span><span class="s1">sigma_2^2)}}$=</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">seff</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span></div>
<span class="c1"># mohrcircle(filename=&quot;&quot;)</span>

<span class="k">def</span> <span class="nf">testing</span><span class="p">(</span><span class="n">funcname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">funcname</span><span class="o">==</span><span class="s1">&#39;bmdiagram&#39;</span><span class="p">:</span>
        <span class="c1"># Lecture 16</span>
        <span class="c1"># P=np.array([-11280,31000])</span>
        <span class="c1"># Q=np.array([2860,7860])</span>
        <span class="c1"># p=0.185</span>
        <span class="c1"># q=p+0.288</span>
        <span class="c1"># L=p+q+0.177</span>
        <span class="c1"># Sheave and Gear Example</span>
        <span class="c1"># P=np.array([-10,0])</span>
        <span class="c1"># Q=np.array([-20,0])</span>
        <span class="c1"># p=-1</span>
        <span class="c1"># q=2.0</span>
        <span class="c1"># L=5.0</span>
        <span class="c1"># c=4.0</span>
        <span class="c1"># hdmixer Shaft #1</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2238</span><span class="p">,</span> <span class="mi">830</span><span class="p">])</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1170</span><span class="p">,</span> <span class="o">-</span><span class="mi">3215</span><span class="p">])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.048</span>  <span class="c1"># ((0+45)/2-(45+95)/2)/1000</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">0.157</span>   <span class="c1"># ((95+359)/2-(45+95)/2)/1000</span>
        <span class="n">L</span> <span class="o">=</span> <span class="mf">0.314</span>   <span class="c1"># ((359+409)/2-(45+95)/2)/1000</span>
        <span class="n">xcrit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.157</span><span class="p">,</span> <span class="mf">0.289</span><span class="p">])</span>
        <span class="c1"># (Mcrit,B,C)=bmdiagram(P,p,L,Q,q,draw=True,xcrit=np.array([-0.02,0.05,0.15,0.25]))</span>
    <span class="c1">#    (Mcrit,B,C)=bmdiagram(P,p,L,draw=True,Q=Q, q=q, xcrit=xcrit,record=True)</span>
        <span class="p">(</span><span class="n">Mcrit</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span><span class="o">=</span><span class="n">bmdiagram</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xcrit</span><span class="o">=</span><span class="n">xcrit</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&gt; bmdiagram(np.array([-2238,830]), -0.048, 0.314, Q=np.array([-1170,-3215]),q=0.157,draw=True,xcrit=np.array([-0.02,0.05,0.15,0.25]))  # returns </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mcrit : &quot;</span><span class="p">,</span> <span class="n">Mcrit</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;B : &quot;</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;C : &quot;</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">funcname</span> <span class="o">==</span> <span class="s2">&quot;bearingpick&quot;</span><span class="p">:</span>
        <span class="n">L10</span> <span class="o">=</span> <span class="mi">3654</span><span class="o">*</span><span class="mf">1e6</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4684</span><span class="p">,</span> <span class="mi">4684</span><span class="p">])</span>
        <span class="n">L10</span> <span class="o">=</span> <span class="mf">11571e6</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">8000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">])</span>
        <span class="n">bearing</span> <span class="o">=</span> <span class="n">bearingpick</span><span class="p">(</span><span class="n">F</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">L10</span><span class="p">,</span> <span class="n">dmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bearingpick(np.array([8,5], 11571e6, dmin=np.array([35, 35]))) --&gt; &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">bearing</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">funcname</span> <span class="o">==</span> <span class="s2">&quot;isofits&quot;</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;H7f6&quot;</span>
        <span class="p">(</span><span class="n">hupper</span><span class="p">,</span> <span class="n">hlower</span><span class="p">,</span> <span class="n">supper</span><span class="p">,</span> <span class="n">slower</span><span class="p">)</span> <span class="o">=</span> <span class="n">isofits</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For a basic size of d=</span><span class="si">%.0f</span><span class="s2"> and &#39;</span><span class="si">%s</span><span class="s2">&#39; fit:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hole : </span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hupper</span><span class="p">,</span> <span class="n">hlower</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shaft: </span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">supper</span><span class="p">,</span> <span class="n">slower</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">funcname</span><span class="o">==</span><span class="s2">&quot;alloyprop&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="n">su</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">rho</span><span class="p">]</span><span class="o">=</span><span class="n">alloyprop</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;nickel&quot;</span><span class="p">,</span> <span class="s2">&quot;N06110&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;SUMPA&quot;</span><span class="p">,</span> <span class="s2">&quot;SYMPA&quot;</span><span class="p">,</span> <span class="s2">&quot;RHO&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;alloyprop(None, &quot;nickel&quot;, &quot;N06110&quot;, [&quot;SUMPA&quot;, &quot;SYMPA&quot;, &quot;RHO&quot;]) :&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">su</span><span class="p">,</span><span class="n">sy</span><span class="p">,</span><span class="n">rho</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">funcname</span><span class="o">==</span><span class="s2">&quot;fixity&quot;</span><span class="p">:</span>
        <span class="n">Ka</span><span class="o">=</span><span class="n">fixity</span><span class="p">(</span><span class="s2">&quot;pinned-fixed&quot;</span><span class="p">)</span>  <span class="c1"># Actual value For pinned-fixed ends</span>
        <span class="n">Ki</span><span class="o">=</span><span class="n">fixity</span><span class="p">(</span><span class="s2">&quot;pinned-fixed&quot;</span><span class="p">,</span> <span class="n">ideal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Ideal value For pinned-fixed ends</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fixity(&#39;pinned-fixed&#39;) --&gt; </span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">Ka</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fixity(&#39;pinned-fixed&#39;, ideal=True) --&gt; </span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">Ki</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">funcname</span><span class="o">==</span><span class="s2">&quot;weldsize&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt; weldsize(18.0) # returns </span><span class="si">%.2f</span><span class="s1"> mm&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">weldsize</span><span class="p">(</span><span class="mf">18.0</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">funcname</span><span class="o">==</span><span class="s2">&quot;alumweldstrength&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&gt;alumweldstrength(6061, 5356) # returns </span><span class="si">%.2f</span><span class="s2"> MPa&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">alumweldstrength</span><span class="p">(</span><span class="mi">6061</span><span class="p">,</span> <span class="mi">5356</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">funcname</span><span class="o">==</span><span class="s2">&quot;ec3cutoff&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&gt; ec3cutoff(</span><span class="si">%d</span><span class="s2">)  # returns </span><span class="si">%.0f</span><span class="s2"> MPa&quot;</span><span class="o">%</span><span class="p">(</span><span class="mi">71</span><span class="p">,</span> <span class="n">ec3cutoff</span><span class="p">(</span><span class="mi">71</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">funcname</span><span class="o">==</span><span class="s2">&quot;ec3life&quot;</span><span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">ec3life</span><span class="p">(</span><span class="mf">120.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&gt; ec3life(120.0, 1.2, joint=&#39;N&#39;)   # returns (</span><span class="si">%.0f</span><span class="s2">,</span><span class="si">%.0f</span><span class="s2">,</span><span class="si">%.0f</span><span class="s2">) cycles&quot;</span><span class="o">%</span>
                 <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        
        


<span class="c1"># General Physics</span>
<span class="k">class</span> <span class="nc">Phasor</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Phasor is a complex number</span>
    <span class="n">dig</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Number of digits in float display</span>
    <span class="n">showpolar</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># The default print is polar format</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">xy</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># This means the magnitude and the angle are specified</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ra</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">PIE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">ra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">PIE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cnum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

    <span class="k">def</span> <span class="nf">conj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="n">realpart</span><span class="p">,</span> <span class="n">imagpart</span><span class="p">)</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Phasor</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">[</span><span class="n">realpart</span><span class="p">,</span> <span class="o">-</span><span class="n">imagpart</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnum</span><span class="p">()</span><span class="o">+</span><span class="n">other</span><span class="o">.</span><span class="n">cnum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Phasor</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">xy</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">xy</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnum</span><span class="p">()</span><span class="o">-</span><span class="n">other</span><span class="o">.</span><span class="n">cnum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Phasor</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">xy</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">xy</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnum</span><span class="p">()</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">cnum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Phasor</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">xy</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">xy</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnum</span><span class="p">()</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cnum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Phasor</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">xy</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">xy</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showpolar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dig</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dig</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dig</span><span class="o">=</span><span class="n">dig</span>
        <span class="n">sf</span> <span class="o">=</span> <span class="s2">&quot;{:.</span><span class="si">%d</span><span class="s2">f}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showpolar</span><span class="o">=</span><span class="n">showpolar</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showpolar</span><span class="p">:</span>
            <span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">sf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;&lt;&quot;</span><span class="o">+</span><span class="n">sf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnum</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">sf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;+j(&quot;</span><span class="o">+</span><span class="n">sf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
        <span class="n">sqrt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">(</span><span class="n">sqrt2</span><span class="p">,</span> <span class="mi">45</span><span class="p">))</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">(</span><span class="n">sqrt2</span><span class="p">,</span> <span class="mi">45</span><span class="p">))</span>
        <span class="c1"># pq = p.sum(q)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">cnum</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p+q=&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">cnum</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p*q=&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">mult</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">cnum</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p/q=&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">cnum</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">delta</span><span class="p">():</span>
    <span class="n">XT</span><span class="o">=</span><span class="mf">0.3</span><span class="o">+</span><span class="mf">0.15</span><span class="o">+</span><span class="mf">0.325</span>
    <span class="n">P</span><span class="o">=</span><span class="mf">0.9</span>
    <span class="n">sindelta</span><span class="o">=</span><span class="n">P</span><span class="o">*</span><span class="n">XT</span>
    <span class="n">delta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">sindelta</span><span class="p">)</span><span class="o">/</span><span class="n">PIE</span><span class="o">*</span><span class="mi">180</span>
    <span class="k">return</span> <span class="n">delta</span>

<span class="k">def</span> <span class="nf">ef</span><span class="p">():</span>
    <span class="n">Et</span><span class="o">=</span><span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
    <span class="n">It</span><span class="o">=</span><span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">36.0</span><span class="p">])</span>
    <span class="n">Xd</span><span class="o">=</span><span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">90</span><span class="p">])</span>
    <span class="n">Ef</span><span class="o">=</span><span class="n">Et</span><span class="o">+</span><span class="n">It</span><span class="o">*</span><span class="n">Xd</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ef = &quot;</span><span class="p">,</span> <span class="n">Ef</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">It</span><span class="p">():</span>
    <span class="n">Ef</span><span class="o">=</span><span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">44.226</span><span class="p">])</span>
    <span class="n">EB</span><span class="o">=</span><span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
    <span class="n">Xd</span><span class="o">=</span><span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">[</span><span class="mf">0.775</span><span class="p">,</span><span class="mf">90.0</span><span class="p">])</span>
    <span class="n">It</span><span class="o">=</span><span class="p">(</span><span class="n">Ef</span><span class="o">-</span><span class="n">EB</span><span class="p">)</span><span class="o">/</span><span class="n">Xd</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;It(E,EB,Xd)=&quot;</span><span class="p">,</span> <span class="n">It</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">It</span>
<span class="k">def</span> <span class="nf">Et</span><span class="p">():</span>
    <span class="n">Ef</span><span class="o">=</span><span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">42.45</span><span class="p">])</span>
    <span class="n">It</span><span class="o">=</span><span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">[</span><span class="mf">2.41</span><span class="p">,</span> <span class="mf">21.225</span><span class="p">])</span>
    <span class="n">Xd</span><span class="o">=</span><span class="n">Phasor</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">90.0</span><span class="p">])</span>
    <span class="n">Et</span><span class="o">=</span><span class="n">Ef</span><span class="o">-</span><span class="n">Xd</span><span class="o">*</span><span class="n">It</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Et(Ef,It,Xd)=&quot;</span><span class="p">,</span> <span class="n">Et</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">libraryver</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;4:17pm 3 June 2021&quot;</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">melib</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">melib API reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Hal Gurgenci.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>